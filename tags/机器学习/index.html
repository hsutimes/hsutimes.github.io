<!DOCTYPE html>
<html  lang="zh">
<head>
    <meta charset="utf-8" />

<meta name="generator" content="Hexo 3.9.0" />

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />

<title>标签: 机器学习 - Time</title>


    <meta name="description" content="blog">
<meta name="keywords" content="hsutimes">
<meta property="og:type" content="website">
<meta property="og:title" content="Time">
<meta property="og:url" content="https://blog.hsutimes.com/tags/机器学习/index.html">
<meta property="og:site_name" content="Time">
<meta property="og:description" content="blog">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://blog.hsutimes.com/images/og_image.png">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Time">
<meta name="twitter:description" content="blog">
<meta name="twitter:image" content="https://blog.hsutimes.com/images/og_image.png">
<meta name="twitter:site" content="https://twitter.com/times26740863">







<link rel="icon" href="/images/favicon.svg">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.7.2/css/bulma.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,600|Source+Code+Pro">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css">


    
    
<style>body>.footer,body>.navbar,body>.section{opacity:0}</style>

    
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css">

    
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css">

    
    
    
    
<link rel="stylesheet" href="/css/back-to-top.css">

    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134224598-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134224598-1');
</script>

    
    
    
    
    
    <link rel="stylesheet" href="/css/progressbar.css">
<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>
    
    <script async="" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    


<link rel="stylesheet" href="/css/style.css">
</head>
<body class="is-3-column">
    <nav class="navbar navbar-main">
    <div class="container">
        <div class="navbar-brand is-flex-center">
            <a class="navbar-item navbar-logo" href="/">
            
                <img src="/images/logo.svg" alt="Time" height="28">
            
            </a>
        </div>
        <div class="navbar-menu">
            
            <div class="navbar-start">
                
                <a class="navbar-item"
                href="/">Home</a>
                
                <a class="navbar-item"
                href="/archives">Archives</a>
                
                <a class="navbar-item"
                href="/categories">Categories</a>
                
                <a class="navbar-item"
                href="/tags">Tags</a>
                
                <a class="navbar-item"
                href="/about">About</a>
                
            </div>
            
            <div class="navbar-end">
                
                    
                    <a class="navbar-item" target="_blank" title="Download on GitHub" href="https://github.com/hsutimes/hsutimes.github.io">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                    
                
                
                
                <a class="navbar-item search" title="搜索" href="javascript:;">
                    <i class="fas fa-search"></i>
                </a>
                
            </div>
        </div>
    </div>
</nav>
    
    <section class="section">
        <div class="container">
            <div class="columns">
                <div class="column is-8-tablet is-8-desktop is-6-widescreen has-order-2 column-main"><div class="card">
    <div class="card-content">
        <nav class="breadcrumb" aria-label="breadcrumbs">
        <ul>
            <li><a href="/tags">标签</a></li>
            <li class="is-active"><a href="#" aria-current="page">机器学习</a></li>
        </ul>
        </nav>
    </div>
</div>

    
<div class="card">
    
    <div class="card-image">
        <a href="/2019/11/18/target-detection-yolo/" class="image is-7by1">
            <img class="thumbnail" src="/images/2019/11/18/cc0d9a30-0a01-11ea-b8d5-416bf8aed005.png" alt="目标检测YOLOv3">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-11-18T12:26:24.000Z">2019-11-18</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/人工智能/">人工智能</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    43 分钟 读完 (大约 6516 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/11/18/target-detection-yolo/">目标检测YOLOv3</a>
            
        </h1>
        <div class="content">
            <h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>YOLOv3 是由 Joseph Redmon 和 Ali Farhadi 提出的单阶段检测器, 该检测器与达到同样精度的传统目标检测方法相比，推断速度能达到接近两倍.<br><img src="/images/2019/11/18/ee49b5e0-09ff-11ea-b8d5-416bf8aed005.png" alt="image.png"></p>
<h1 id="模型结构"><a href="#模型结构" class="headerlink" title="模型结构"></a>模型结构</h1><p>YOLOv3将输入图像分成S<em>S个格子，每个格子预测B个bounding box，每个bounding box预测内容包括: Location(x, y, w, h)、Confidence Score和C个类别的概率，因此YOLOv3输出层的channel数为B</em>(5 + C)。YOLOv3的loss函数也有三部分组成：Location误差，Confidence误差和分类误差。</p>
<p>YOLOv3的网络结构如下图所示:</p>
<p><img src="/images/2019/11/18/5fd529d0-09fe-11ea-b8d5-416bf8aed005.png" alt="image.png"></p>
<p>YOLOv3 的网络结构由基础特征提取网络、multi-scale特征融合层和输出层组成。</p>
<ol>
<li><p>特征提取网络。YOLOv3使用 DarkNet53作为特征提取网络：DarkNet53 基本采用了全卷积网络，用步长为2的卷积操作替代了池化层，同时添加了 Residual 单元，避免在网络层数过深时发生梯度弥散。</p>
</li>
<li><p>特征融合层。为了解决之前YOLO版本对小目标不敏感的问题，YOLOv3采用了3个不同尺度的特征图来进行目标检测，分别为13<em>13,26</em>26,52*52,用来检测大、中、小三种目标。特征融合层选取 DarkNet 产出的三种尺度特征图作为输入，借鉴了FPN(feature pyramid networks)的思想，通过一系列的卷积层和上采样对各尺度的特征图进行融合。</p>
</li>
<li><p>输出层。同样使用了全卷积结构，其中最后一个卷积层的卷积核个数是255：3*(80+4+1)=255，3表示一个grid cell包含3个bounding box，4表示框的4个坐标信息，1表示Confidence Score，80表示COCO数据集中80个类别的概率。如果换用别的数据集，80可以更改为实际类别数量</p>
</li>
</ol>
<ul>
<li>论文链接：<a href="https://arxiv.org/pdf/1804.02767v1.pdf" target="_blank" rel="noopener">https://arxiv.org/pdf/1804.02767v1.pdf</a></li>
</ul>
<h1 id="解压螺丝螺母训练数据"><a href="#解压螺丝螺母训练数据" class="headerlink" title="解压螺丝螺母训练数据"></a>解压螺丝螺母训练数据</h1><p>背景非常干净小巧的目标检测数据集。 里面仅仅包含螺丝和螺母两种类别的目标，背景为干净的培养皿。图片数量约420张，train.txt 文件描述每个图片中的目标，label_list 文件描述类别</p>
<p>另附一个验证集合，有10张图片，eval.txt 描述图片中目标，格式和 train.txt 相同</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"># 解压螺丝螺母数据，并将数据处理成需要的格式</span></span><br><span class="line">!cd data/data6045/ &amp;&amp; unzip -qo lslm.zip &amp;&amp; unzip -qo lslm-test.zip</span><br><span class="line">!cd data/data6045/ &amp;&amp; mv lslm/*.txt .</span><br><span class="line">!cd data/data6045/ &amp;&amp; mv lslm-test/*.txt .</span><br><span class="line">!cd data/data6045/ &amp;&amp; sed -i <span class="hljs-string">'s/^/lslm\//'</span> train.txt</span><br><span class="line">!cd data/data6045/ &amp;&amp; sed -i <span class="hljs-string">'s/^/lslm-test\//'</span> eval.txt</span><br><span class="line">!cd data/data6045/ &amp;&amp; awk <span class="hljs-string">'&#123;print $2&#125;'</span> label_list.txt &gt; label_list</span><br></pre></td></tr></table></figure>

<h1 id="训练配置"><a href="#训练配置" class="headerlink" title="训练配置"></a>训练配置</h1><p>训练YOLOv3模型的配置项，配置里控制以下行为：</p>
<ul>
<li>可以控制是否启用tiny版本，tiny版本体积小，适合部署在移动设备。本次实验默认使用 tiny</li>
<li>训练轮数</li>
<li>每批次训练图片数量</li>
<li>是否使用GPU训练</li>
<li>学习率调整</li>
<li>训练图片尺寸 &amp; anchors 的尺寸<br>如果不熟悉，请不要随便更改训练图片的尺寸和anchors的尺寸，两者相互关联</li>
</ul>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"><span class="hljs-string">"""</span></span><br><span class="line"><span class="hljs-string">训练常基于dark-net的YOLOv3网络，目标检测</span></span><br><span class="line"><span class="hljs-string">"""</span></span><br><span class="line"><span class="hljs-keyword">from</span> __future__ <span class="hljs-keyword">import</span> absolute_import</span><br><span class="line"><span class="hljs-keyword">from</span> __future__ <span class="hljs-keyword">import</span> division</span><br><span class="line"><span class="hljs-keyword">from</span> __future__ <span class="hljs-keyword">import</span> print_function</span><br><span class="line"><span class="hljs-keyword">import</span> os</span><br><span class="line">os.environ[<span class="hljs-string">"FLAGS_fraction_of_gpu_memory_to_use"</span>] = <span class="hljs-string">'0.82'</span></span><br><span class="line"><span class="hljs-keyword">import</span> uuid</span><br><span class="line"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np</span><br><span class="line"><span class="hljs-keyword">import</span> time</span><br><span class="line"><span class="hljs-keyword">import</span> six</span><br><span class="line"><span class="hljs-keyword">import</span> math</span><br><span class="line"><span class="hljs-keyword">import</span> random</span><br><span class="line"><span class="hljs-keyword">import</span> paddle</span><br><span class="line"><span class="hljs-keyword">import</span> paddle.fluid <span class="hljs-keyword">as</span> fluid</span><br><span class="line"><span class="hljs-keyword">import</span> logging</span><br><span class="line"><span class="hljs-keyword">import</span> xml.etree.ElementTree</span><br><span class="line"><span class="hljs-keyword">import</span> codecs</span><br><span class="line"><span class="hljs-keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">from</span> paddle.fluid.initializer <span class="hljs-keyword">import</span> MSRA</span><br><span class="line"><span class="hljs-keyword">from</span> paddle.fluid.param_attr <span class="hljs-keyword">import</span> ParamAttr</span><br><span class="line"><span class="hljs-keyword">from</span> paddle.fluid.regularizer <span class="hljs-keyword">import</span> L2Decay</span><br><span class="line"><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image, ImageEnhance, ImageDraw</span><br><span class="line"></span><br><span class="line">logger = <span class="hljs-literal">None</span></span><br><span class="line">train_parameters = &#123;</span><br><span class="line">    <span class="hljs-string">"data_dir"</span>: <span class="hljs-string">"data/data6045"</span>,</span><br><span class="line">    <span class="hljs-string">"train_list"</span>: <span class="hljs-string">"train.txt"</span>,</span><br><span class="line">    <span class="hljs-string">"eval_list"</span>: <span class="hljs-string">"eval.txt"</span>,</span><br><span class="line">    <span class="hljs-string">"class_dim"</span>: <span class="hljs-number">-1</span>,</span><br><span class="line">    <span class="hljs-string">"label_dict"</span>: &#123;&#125;,</span><br><span class="line">    <span class="hljs-string">"num_dict"</span>: &#123;&#125;,</span><br><span class="line">    <span class="hljs-string">"image_count"</span>: <span class="hljs-number">-1</span>,</span><br><span class="line">    <span class="hljs-string">"continue_train"</span>: <span class="hljs-literal">True</span>,     <span class="hljs-comment"># 是否加载前一次的训练参数，接着训练</span></span><br><span class="line">    <span class="hljs-string">"pretrained"</span>: <span class="hljs-literal">False</span>,</span><br><span class="line">    <span class="hljs-string">"pretrained_model_dir"</span>: <span class="hljs-string">"./pretrained-model"</span>,</span><br><span class="line">    <span class="hljs-string">"save_model_dir"</span>: <span class="hljs-string">"./yolo-model"</span>,</span><br><span class="line">    <span class="hljs-string">"model_prefix"</span>: <span class="hljs-string">"yolo-v3"</span>,</span><br><span class="line">    <span class="hljs-string">"freeze_dir"</span>: <span class="hljs-string">"freeze_model"</span>,</span><br><span class="line">    <span class="hljs-string">"use_tiny"</span>: <span class="hljs-literal">True</span>,          <span class="hljs-comment"># 是否使用 裁剪 tiny 模型</span></span><br><span class="line">    <span class="hljs-string">"max_box_num"</span>: <span class="hljs-number">20</span>,          <span class="hljs-comment"># 一幅图上最多有多少个目标</span></span><br><span class="line">    <span class="hljs-string">"num_epochs"</span>: <span class="hljs-number">80</span>,</span><br><span class="line">    <span class="hljs-string">"train_batch_size"</span>: <span class="hljs-number">32</span>,      <span class="hljs-comment"># 对于完整 yolov3，每一批的训练样本不能太多，内存会炸掉；如果使用 tiny，可以适当大一些</span></span><br><span class="line">    <span class="hljs-string">"use_gpu"</span>: <span class="hljs-literal">True</span>,</span><br><span class="line">    <span class="hljs-string">"yolo_cfg"</span>: &#123;</span><br><span class="line">        <span class="hljs-string">"input_size"</span>: [<span class="hljs-number">3</span>, <span class="hljs-number">448</span>, <span class="hljs-number">448</span>],    <span class="hljs-comment"># 原版的边长大小为608，为了提高训练速度和预测速度，此处压缩为448</span></span><br><span class="line">        <span class="hljs-string">"anchors"</span>: [<span class="hljs-number">7</span>, <span class="hljs-number">10</span>, <span class="hljs-number">12</span>, <span class="hljs-number">22</span>, <span class="hljs-number">24</span>, <span class="hljs-number">17</span>, <span class="hljs-number">22</span>, <span class="hljs-number">45</span>, <span class="hljs-number">46</span>, <span class="hljs-number">33</span>, <span class="hljs-number">43</span>, <span class="hljs-number">88</span>, <span class="hljs-number">85</span>, <span class="hljs-number">66</span>, <span class="hljs-number">115</span>, <span class="hljs-number">146</span>, <span class="hljs-number">275</span>, <span class="hljs-number">240</span>],</span><br><span class="line">        <span class="hljs-string">"anchor_mask"</span>: [[<span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>], [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>], [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>]]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="hljs-string">"yolo_tiny_cfg"</span>: &#123;</span><br><span class="line">        <span class="hljs-string">"input_size"</span>: [<span class="hljs-number">3</span>, <span class="hljs-number">256</span>, <span class="hljs-number">256</span>],</span><br><span class="line">        <span class="hljs-string">"anchors"</span>: [<span class="hljs-number">6</span>, <span class="hljs-number">8</span>, <span class="hljs-number">13</span>, <span class="hljs-number">15</span>, <span class="hljs-number">22</span>, <span class="hljs-number">34</span>, <span class="hljs-number">48</span>, <span class="hljs-number">50</span>, <span class="hljs-number">81</span>, <span class="hljs-number">100</span>, <span class="hljs-number">205</span>, <span class="hljs-number">191</span>],</span><br><span class="line">        <span class="hljs-string">"anchor_mask"</span>: [[<span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>], [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>]]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="hljs-string">"ignore_thresh"</span>: <span class="hljs-number">0.7</span>,</span><br><span class="line">    <span class="hljs-string">"mean_rgb"</span>: [<span class="hljs-number">127.5</span>, <span class="hljs-number">127.5</span>, <span class="hljs-number">127.5</span>],</span><br><span class="line">    <span class="hljs-string">"mode"</span>: <span class="hljs-string">"train"</span>,</span><br><span class="line">    <span class="hljs-string">"multi_data_reader_count"</span>: <span class="hljs-number">4</span>,</span><br><span class="line">    <span class="hljs-string">"apply_distort"</span>: <span class="hljs-literal">True</span>,</span><br><span class="line">    <span class="hljs-string">"nms_top_k"</span>: <span class="hljs-number">300</span>,</span><br><span class="line">    <span class="hljs-string">"nms_pos_k"</span>: <span class="hljs-number">300</span>,</span><br><span class="line">    <span class="hljs-string">"valid_thresh"</span>: <span class="hljs-number">0.01</span>,</span><br><span class="line">    <span class="hljs-string">"nms_thresh"</span>: <span class="hljs-number">0.45</span>,</span><br><span class="line">    <span class="hljs-string">"image_distort_strategy"</span>: &#123;</span><br><span class="line">        <span class="hljs-string">"expand_prob"</span>: <span class="hljs-number">0.5</span>,</span><br><span class="line">        <span class="hljs-string">"expand_max_ratio"</span>: <span class="hljs-number">4</span>,</span><br><span class="line">        <span class="hljs-string">"hue_prob"</span>: <span class="hljs-number">0.5</span>,</span><br><span class="line">        <span class="hljs-string">"hue_delta"</span>: <span class="hljs-number">18</span>,</span><br><span class="line">        <span class="hljs-string">"contrast_prob"</span>: <span class="hljs-number">0.5</span>,</span><br><span class="line">        <span class="hljs-string">"contrast_delta"</span>: <span class="hljs-number">0.5</span>,</span><br><span class="line">        <span class="hljs-string">"saturation_prob"</span>: <span class="hljs-number">0.5</span>,</span><br><span class="line">        <span class="hljs-string">"saturation_delta"</span>: <span class="hljs-number">0.5</span>,</span><br><span class="line">        <span class="hljs-string">"brightness_prob"</span>: <span class="hljs-number">0.5</span>,</span><br><span class="line">        <span class="hljs-string">"brightness_delta"</span>: <span class="hljs-number">0.125</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="hljs-string">"sgd_strategy"</span>: &#123;</span><br><span class="line">        <span class="hljs-string">"learning_rate"</span>: <span class="hljs-number">0.002</span>,</span><br><span class="line">        <span class="hljs-string">"lr_epochs"</span>: [<span class="hljs-number">30</span>, <span class="hljs-number">50</span>, <span class="hljs-number">65</span>],</span><br><span class="line">        <span class="hljs-string">"lr_decay"</span>: [<span class="hljs-number">1</span>, <span class="hljs-number">0.5</span>, <span class="hljs-number">0.25</span>, <span class="hljs-number">0.1</span>]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="hljs-string">"early_stop"</span>: &#123;</span><br><span class="line">        <span class="hljs-string">"sample_frequency"</span>: <span class="hljs-number">50</span>,</span><br><span class="line">        <span class="hljs-string">"successive_limit"</span>: <span class="hljs-number">3</span>,</span><br><span class="line">        <span class="hljs-string">"min_loss"</span>: <span class="hljs-number">2.5</span>,</span><br><span class="line">        <span class="hljs-string">"min_curr_map"</span>: <span class="hljs-number">0.84</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">init_train_parameters</span><span class="hljs-params">()</span>:</span></span><br><span class="line">    <span class="hljs-string">"""</span></span><br><span class="line"><span class="hljs-string">    初始化训练参数，主要是初始化图片数量，类别数</span></span><br><span class="line"><span class="hljs-string">    :return:</span></span><br><span class="line"><span class="hljs-string">    """</span></span><br><span class="line">    file_list = os.path.join(train_parameters[<span class="hljs-string">'data_dir'</span>], train_parameters[<span class="hljs-string">'train_list'</span>])</span><br><span class="line">    label_list = os.path.join(train_parameters[<span class="hljs-string">'data_dir'</span>], <span class="hljs-string">"label_list"</span>)</span><br><span class="line">    index = <span class="hljs-number">0</span></span><br><span class="line">    <span class="hljs-keyword">with</span> codecs.open(label_list, encoding=<span class="hljs-string">'utf-8'</span>) <span class="hljs-keyword">as</span> flist:</span><br><span class="line">        lines = [line.strip() <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> flist]</span><br><span class="line">        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> lines:</span><br><span class="line">            train_parameters[<span class="hljs-string">'num_dict'</span>][index] = line.strip()</span><br><span class="line">            train_parameters[<span class="hljs-string">'label_dict'</span>][line.strip()] = index</span><br><span class="line">            index += <span class="hljs-number">1</span></span><br><span class="line">        train_parameters[<span class="hljs-string">'class_dim'</span>] = index</span><br><span class="line">    <span class="hljs-keyword">with</span> codecs.open(file_list, encoding=<span class="hljs-string">'utf-8'</span>) <span class="hljs-keyword">as</span> flist:</span><br><span class="line">        lines = [line.strip() <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> flist]</span><br><span class="line">        train_parameters[<span class="hljs-string">'image_count'</span>] = len(lines)</span><br></pre></td></tr></table></figure>

<h1 id="日志相关的配置"><a href="#日志相关的配置" class="headerlink" title="日志相关的配置"></a>日志相关的配置</h1><figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">init_log_config</span><span class="hljs-params">()</span>:</span></span><br><span class="line">    <span class="hljs-string">"""</span></span><br><span class="line"><span class="hljs-string">    初始化日志相关配置</span></span><br><span class="line"><span class="hljs-string">    :return:</span></span><br><span class="line"><span class="hljs-string">    """</span></span><br><span class="line">    <span class="hljs-keyword">global</span> logger</span><br><span class="line">    logger = logging.getLogger()</span><br><span class="line">    logger.setLevel(logging.INFO)</span><br><span class="line">    log_path = os.path.join(os.getcwd(), <span class="hljs-string">'logs'</span>)</span><br><span class="line">    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(log_path):</span><br><span class="line">        os.makedirs(log_path)</span><br><span class="line">    log_name = os.path.join(log_path, <span class="hljs-string">'train.log'</span>)</span><br><span class="line">    fh = logging.FileHandler(log_name, mode=<span class="hljs-string">'w'</span>)</span><br><span class="line">    fh.setLevel(logging.DEBUG)</span><br><span class="line">    formatter = logging.Formatter(<span class="hljs-string">"%(asctime)s - %(filename)s[line:%(lineno)d] - %(levelname)s: %(message)s"</span>)</span><br><span class="line">    fh.setFormatter(formatter)</span><br><span class="line">    logger.addHandler(fh)</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">init_log_config()</span><br></pre></td></tr></table></figure>

<h1 id="YOLOv3网络结构"><a href="#YOLOv3网络结构" class="headerlink" title="YOLOv3网络结构"></a>YOLOv3网络结构</h1><ul>
<li>YOLOv3网络结构</li>
<li>YOLOv3-tiny网络结构<br>根据配置使用不同的模型</li>
</ul>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">YOLOv3</span><span class="hljs-params">(object)</span>:</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self, class_num, anchors, anchor_mask)</span>:</span></span><br><span class="line">        self.outputs = []</span><br><span class="line">        self.downsample_ratio = <span class="hljs-number">1</span></span><br><span class="line">        self.anchor_mask = anchor_mask</span><br><span class="line">        self.anchors = anchors</span><br><span class="line">        self.class_num = class_num</span><br><span class="line"></span><br><span class="line">        self.yolo_anchors = []</span><br><span class="line">        self.yolo_classes = []</span><br><span class="line">        <span class="hljs-keyword">for</span> mask_pair <span class="hljs-keyword">in</span> self.anchor_mask:</span><br><span class="line">            mask_anchors = []</span><br><span class="line">            <span class="hljs-keyword">for</span> mask <span class="hljs-keyword">in</span> mask_pair:</span><br><span class="line">                mask_anchors.append(self.anchors[<span class="hljs-number">2</span> * mask])</span><br><span class="line">                mask_anchors.append(self.anchors[<span class="hljs-number">2</span> * mask + <span class="hljs-number">1</span>])</span><br><span class="line">            self.yolo_anchors.append(mask_anchors)</span><br><span class="line">            self.yolo_classes.append(class_num)</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">name</span><span class="hljs-params">(self)</span>:</span></span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-string">'YOLOv3'</span></span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_anchors</span><span class="hljs-params">(self)</span>:</span></span><br><span class="line">        <span class="hljs-keyword">return</span> self.anchors</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_anchor_mask</span><span class="hljs-params">(self)</span>:</span></span><br><span class="line">        <span class="hljs-keyword">return</span> self.anchor_mask</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_class_num</span><span class="hljs-params">(self)</span>:</span></span><br><span class="line">        <span class="hljs-keyword">return</span> self.class_num</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_downsample_ratio</span><span class="hljs-params">(self)</span>:</span></span><br><span class="line">        <span class="hljs-keyword">return</span> self.downsample_ratio</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_yolo_anchors</span><span class="hljs-params">(self)</span>:</span></span><br><span class="line">        <span class="hljs-keyword">return</span> self.yolo_anchors</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_yolo_classes</span><span class="hljs-params">(self)</span>:</span></span><br><span class="line">        <span class="hljs-keyword">return</span> self.yolo_classes</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">conv_bn</span><span class="hljs-params">(self,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">                input,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">                num_filters,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">                filter_size,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">                stride,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">                padding,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">                use_cudnn=True)</span>:</span></span><br><span class="line">        conv = fluid.layers.conv2d(</span><br><span class="line">            input=input,</span><br><span class="line">            num_filters=num_filters,</span><br><span class="line">            filter_size=filter_size,</span><br><span class="line">            stride=stride,</span><br><span class="line">            padding=padding,</span><br><span class="line">            act=<span class="hljs-literal">None</span>,</span><br><span class="line">            use_cudnn=use_cudnn,</span><br><span class="line">            param_attr=ParamAttr(initializer=fluid.initializer.Normal(<span class="hljs-number">0.</span>, <span class="hljs-number">0.02</span>)),</span><br><span class="line">            bias_attr=<span class="hljs-literal">False</span>)</span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment"># batch_norm中的参数不需要参与正则化，所以主动使用正则系数为0的正则项屏蔽掉</span></span><br><span class="line">        <span class="hljs-comment"># 在batch_norm中使用 leaky 的话，只能使用默认的 alpha=0.02；如果需要设值，必须提出去单独来</span></span><br><span class="line">        out = fluid.layers.batch_norm(</span><br><span class="line">            input=conv, act=<span class="hljs-literal">None</span>, </span><br><span class="line">            param_attr=ParamAttr(initializer=fluid.initializer.Normal(<span class="hljs-number">0.</span>, <span class="hljs-number">0.02</span>), regularizer=L2Decay(<span class="hljs-number">0.</span>)),</span><br><span class="line">            bias_attr=ParamAttr(initializer=fluid.initializer.Constant(<span class="hljs-number">0.0</span>), regularizer=L2Decay(<span class="hljs-number">0.</span>)))</span><br><span class="line">        out = fluid.layers.leaky_relu(out, <span class="hljs-number">0.1</span>)</span><br><span class="line">        <span class="hljs-keyword">return</span> out</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">downsample</span><span class="hljs-params">(self, input, num_filters, filter_size=<span class="hljs-number">3</span>, stride=<span class="hljs-number">2</span>, padding=<span class="hljs-number">1</span>)</span>:</span></span><br><span class="line">        self.downsample_ratio *= <span class="hljs-number">2</span></span><br><span class="line">        <span class="hljs-keyword">return</span> self.conv_bn(input, </span><br><span class="line">                num_filters=num_filters, </span><br><span class="line">                filter_size=filter_size, </span><br><span class="line">                stride=stride, </span><br><span class="line">                padding=padding)</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">basicblock</span><span class="hljs-params">(self, input, num_filters)</span>:</span></span><br><span class="line">        conv1 = self.conv_bn(input, num_filters, filter_size=<span class="hljs-number">1</span>, stride=<span class="hljs-number">1</span>, padding=<span class="hljs-number">0</span>)</span><br><span class="line">        conv2 = self.conv_bn(conv1, num_filters * <span class="hljs-number">2</span>, filter_size=<span class="hljs-number">3</span>, stride=<span class="hljs-number">1</span>, padding=<span class="hljs-number">1</span>)</span><br><span class="line">        out = fluid.layers.elementwise_add(x=input, y=conv2, act=<span class="hljs-literal">None</span>)</span><br><span class="line">        <span class="hljs-keyword">return</span> out</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">layer_warp</span><span class="hljs-params">(self, input, num_filters, count)</span>:</span></span><br><span class="line">        res_out = self.basicblock(input, num_filters)</span><br><span class="line">        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> range(<span class="hljs-number">1</span>, count):</span><br><span class="line">            res_out = self.basicblock(res_out, num_filters)</span><br><span class="line">        <span class="hljs-keyword">return</span> res_out</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">upsample</span><span class="hljs-params">(self, input, scale=<span class="hljs-number">2</span>)</span>:</span></span><br><span class="line">        <span class="hljs-comment"># get dynamic upsample output shape</span></span><br><span class="line">        shape_nchw = fluid.layers.shape(input)</span><br><span class="line">        shape_hw = fluid.layers.slice(shape_nchw, axes=[<span class="hljs-number">0</span>], starts=[<span class="hljs-number">2</span>], ends=[<span class="hljs-number">4</span>])</span><br><span class="line">        shape_hw.stop_gradient = <span class="hljs-literal">True</span></span><br><span class="line">        in_shape = fluid.layers.cast(shape_hw, dtype=<span class="hljs-string">'int32'</span>)</span><br><span class="line">        out_shape = in_shape * scale</span><br><span class="line">        out_shape.stop_gradient = <span class="hljs-literal">True</span></span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment"># reisze by actual_shape</span></span><br><span class="line">        out = fluid.layers.resize_nearest(</span><br><span class="line">            input=input,</span><br><span class="line">            scale=scale,</span><br><span class="line">            actual_shape=out_shape)</span><br><span class="line">        <span class="hljs-keyword">return</span> out</span><br><span class="line">    </span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">yolo_detection_block</span><span class="hljs-params">(self, input, num_filters)</span>:</span></span><br><span class="line">        <span class="hljs-keyword">assert</span> num_filters % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>, <span class="hljs-string">"num_filters &#123;&#125; cannot be divided by 2"</span>.format(num_filters)</span><br><span class="line">        conv = input</span><br><span class="line">        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> range(<span class="hljs-number">2</span>):</span><br><span class="line">            conv = self.conv_bn(conv, num_filters, filter_size=<span class="hljs-number">1</span>, stride=<span class="hljs-number">1</span>, padding=<span class="hljs-number">0</span>)</span><br><span class="line">            conv = self.conv_bn(conv, num_filters * <span class="hljs-number">2</span>, filter_size=<span class="hljs-number">3</span>, stride=<span class="hljs-number">1</span>, padding=<span class="hljs-number">1</span>)</span><br><span class="line">        route = self.conv_bn(conv, num_filters, filter_size=<span class="hljs-number">1</span>, stride=<span class="hljs-number">1</span>, padding=<span class="hljs-number">0</span>)</span><br><span class="line">        tip = self.conv_bn(route, num_filters * <span class="hljs-number">2</span>, filter_size=<span class="hljs-number">3</span>, stride=<span class="hljs-number">1</span>, padding=<span class="hljs-number">1</span>)</span><br><span class="line">        <span class="hljs-keyword">return</span> route, tip</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">net</span><span class="hljs-params">(self, img)</span>:</span> </span><br><span class="line">        <span class="hljs-comment"># darknet</span></span><br><span class="line">        stages = [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">8</span>,<span class="hljs-number">8</span>,<span class="hljs-number">4</span>]</span><br><span class="line">        <span class="hljs-keyword">assert</span> len(self.anchor_mask) &lt;= len(stages), <span class="hljs-string">"anchor masks can't bigger than downsample times"</span></span><br><span class="line">        <span class="hljs-comment"># 256x256</span></span><br><span class="line">        conv1 = self.conv_bn(img, num_filters=<span class="hljs-number">32</span>, filter_size=<span class="hljs-number">3</span>, stride=<span class="hljs-number">1</span>, padding=<span class="hljs-number">1</span>)</span><br><span class="line">        downsample_  = self.downsample(conv1, conv1.shape[<span class="hljs-number">1</span>] * <span class="hljs-number">2</span>)</span><br><span class="line">        blocks = []</span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">for</span> i, stage_count <span class="hljs-keyword">in</span> enumerate(stages):</span><br><span class="line">            block = self.layer_warp(downsample_, <span class="hljs-number">32</span> *(<span class="hljs-number">2</span>**i), stage_count)</span><br><span class="line">            blocks.append(block)</span><br><span class="line">            <span class="hljs-keyword">if</span> i &lt; len(stages) - <span class="hljs-number">1</span>:</span><br><span class="line">                downsample_ = self.downsample(block, block.shape[<span class="hljs-number">1</span>]*<span class="hljs-number">2</span>)</span><br><span class="line">        blocks = blocks[<span class="hljs-number">-1</span>:<span class="hljs-number">-4</span>:<span class="hljs-number">-1</span>]   <span class="hljs-comment"># 取倒数三层，并且逆序，后面跨层级联需要</span></span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment"># yolo detector</span></span><br><span class="line">        <span class="hljs-keyword">for</span> i, block <span class="hljs-keyword">in</span> enumerate(blocks):</span><br><span class="line">            <span class="hljs-comment"># yolo 中跨视域链接</span></span><br><span class="line">            <span class="hljs-keyword">if</span> i &gt; <span class="hljs-number">0</span>:</span><br><span class="line">                block = fluid.layers.concat(input=[route, block], axis=<span class="hljs-number">1</span>)</span><br><span class="line">            route, tip = self.yolo_detection_block(block, num_filters=<span class="hljs-number">512</span> // (<span class="hljs-number">2</span>**i))</span><br><span class="line">            block_out = fluid.layers.conv2d(</span><br><span class="line">                input=tip,</span><br><span class="line">                num_filters=len(self.anchor_mask[i]) * (self.class_num + <span class="hljs-number">5</span>),      <span class="hljs-comment"># 5 elements represent x|y|h|w|score</span></span><br><span class="line">                filter_size=<span class="hljs-number">1</span>,</span><br><span class="line">                stride=<span class="hljs-number">1</span>,</span><br><span class="line">                padding=<span class="hljs-number">0</span>,</span><br><span class="line">                act=<span class="hljs-literal">None</span>,</span><br><span class="line">                param_attr=ParamAttr(initializer=fluid.initializer.Normal(<span class="hljs-number">0.</span>, <span class="hljs-number">0.02</span>)),</span><br><span class="line">                bias_attr=ParamAttr(initializer=fluid.initializer.Constant(<span class="hljs-number">0.0</span>), regularizer=L2Decay(<span class="hljs-number">0.</span>)))</span><br><span class="line">            self.outputs.append(block_out)</span><br><span class="line">            <span class="hljs-comment"># 为了跨视域链接，差值方式提升特征图尺寸</span></span><br><span class="line">            <span class="hljs-keyword">if</span> i &lt; len(blocks) - <span class="hljs-number">1</span>:</span><br><span class="line">                route = self.conv_bn(route, <span class="hljs-number">256</span>//(<span class="hljs-number">2</span>**i), filter_size=<span class="hljs-number">1</span>, stride=<span class="hljs-number">1</span>, padding=<span class="hljs-number">0</span>)</span><br><span class="line">                route = self.upsample(route)</span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">return</span> self.outputs</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">YOLOv3Tiny</span><span class="hljs-params">(object)</span>:</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self, class_num, anchors, anchor_mask)</span>:</span></span><br><span class="line">        self.outputs = []</span><br><span class="line">        self.downsample_ratio = <span class="hljs-number">1</span></span><br><span class="line">        self.anchor_mask = anchor_mask</span><br><span class="line">        self.anchors = anchors</span><br><span class="line">        self.class_num = class_num</span><br><span class="line"></span><br><span class="line">        self.yolo_anchors = []</span><br><span class="line">        self.yolo_classes = []</span><br><span class="line">        <span class="hljs-keyword">for</span> mask_pair <span class="hljs-keyword">in</span> self.anchor_mask:</span><br><span class="line">            mask_anchors = []</span><br><span class="line">            <span class="hljs-keyword">for</span> mask <span class="hljs-keyword">in</span> mask_pair:</span><br><span class="line">                mask_anchors.append(self.anchors[<span class="hljs-number">2</span> * mask])</span><br><span class="line">                mask_anchors.append(self.anchors[<span class="hljs-number">2</span> * mask + <span class="hljs-number">1</span>])</span><br><span class="line">            self.yolo_anchors.append(mask_anchors)</span><br><span class="line">            self.yolo_classes.append(class_num)</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">name</span><span class="hljs-params">(self)</span>:</span></span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-string">'YOLOv3-tiny'</span></span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_anchors</span><span class="hljs-params">(self)</span>:</span></span><br><span class="line">        <span class="hljs-keyword">return</span> self.anchors</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_anchor_mask</span><span class="hljs-params">(self)</span>:</span></span><br><span class="line">        <span class="hljs-keyword">return</span> self.anchor_mask</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_class_num</span><span class="hljs-params">(self)</span>:</span></span><br><span class="line">        <span class="hljs-keyword">return</span> self.class_num</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_downsample_ratio</span><span class="hljs-params">(self)</span>:</span></span><br><span class="line">        <span class="hljs-keyword">return</span> self.downsample_ratio</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_yolo_anchors</span><span class="hljs-params">(self)</span>:</span></span><br><span class="line">        <span class="hljs-keyword">return</span> self.yolo_anchors</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_yolo_classes</span><span class="hljs-params">(self)</span>:</span></span><br><span class="line">        <span class="hljs-keyword">return</span> self.yolo_classes</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">conv_bn</span><span class="hljs-params">(self,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">                input,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">                num_filters,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">                filter_size,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">                stride,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">                padding,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">                num_groups=<span class="hljs-number">1</span>,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">                use_cudnn=True)</span>:</span></span><br><span class="line">        conv = fluid.layers.conv2d(</span><br><span class="line">            input=input,</span><br><span class="line">            num_filters=num_filters,</span><br><span class="line">            filter_size=filter_size,</span><br><span class="line">            stride=stride,</span><br><span class="line">            padding=padding,</span><br><span class="line">            act=<span class="hljs-literal">None</span>,</span><br><span class="line">            groups=num_groups,</span><br><span class="line">            use_cudnn=use_cudnn,</span><br><span class="line">            param_attr=ParamAttr(initializer=fluid.initializer.Normal(<span class="hljs-number">0.</span>, <span class="hljs-number">0.02</span>)),</span><br><span class="line">            bias_attr=<span class="hljs-literal">False</span>)</span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment"># batch_norm中的参数不需要参与正则化，所以主动使用正则系数为0的正则项屏蔽掉</span></span><br><span class="line">        out = fluid.layers.batch_norm(</span><br><span class="line">            input=conv, act=<span class="hljs-string">'relu'</span>, </span><br><span class="line">            param_attr=ParamAttr(initializer=fluid.initializer.Normal(<span class="hljs-number">0.</span>, <span class="hljs-number">0.02</span>), regularizer=L2Decay(<span class="hljs-number">0.</span>)),</span><br><span class="line">            bias_attr=ParamAttr(initializer=fluid.initializer.Constant(<span class="hljs-number">0.0</span>), regularizer=L2Decay(<span class="hljs-number">0.</span>)))</span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">return</span> out</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">depthwise_conv_bn</span><span class="hljs-params">(self, input, filter_size=<span class="hljs-number">3</span>, stride=<span class="hljs-number">1</span>, padding=<span class="hljs-number">1</span>)</span>:</span></span><br><span class="line">        num_filters = input.shape[<span class="hljs-number">1</span>]</span><br><span class="line">        <span class="hljs-keyword">return</span> self.conv_bn(input, </span><br><span class="line">                num_filters=num_filters, </span><br><span class="line">                filter_size=filter_size, </span><br><span class="line">                stride=stride, </span><br><span class="line">                padding=padding, </span><br><span class="line">                num_groups=num_filters)</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">downsample</span><span class="hljs-params">(self, input, pool_size=<span class="hljs-number">2</span>, pool_stride=<span class="hljs-number">2</span>)</span>:</span></span><br><span class="line">        self.downsample_ratio *= <span class="hljs-number">2</span></span><br><span class="line">        <span class="hljs-keyword">return</span> fluid.layers.pool2d(input=input, pool_type=<span class="hljs-string">'max'</span>, pool_size=pool_size,</span><br><span class="line">                                    pool_stride=pool_stride)</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">basicblock</span><span class="hljs-params">(self, input, num_filters)</span>:</span></span><br><span class="line">        conv1 = self.conv_bn(input, num_filters, filter_size=<span class="hljs-number">3</span>, stride=<span class="hljs-number">1</span>, padding=<span class="hljs-number">1</span>)</span><br><span class="line">        out = self.downsample(conv1)</span><br><span class="line">        <span class="hljs-keyword">return</span> out</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">upsample</span><span class="hljs-params">(self, input, scale=<span class="hljs-number">2</span>)</span>:</span></span><br><span class="line">        <span class="hljs-comment"># get dynamic upsample output shape</span></span><br><span class="line">        shape_nchw = fluid.layers.shape(input)</span><br><span class="line">        shape_hw = fluid.layers.slice(shape_nchw, axes=[<span class="hljs-number">0</span>], starts=[<span class="hljs-number">2</span>], ends=[<span class="hljs-number">4</span>])</span><br><span class="line">        shape_hw.stop_gradient = <span class="hljs-literal">True</span></span><br><span class="line">        in_shape = fluid.layers.cast(shape_hw, dtype=<span class="hljs-string">'int32'</span>)</span><br><span class="line">        out_shape = in_shape * scale</span><br><span class="line">        out_shape.stop_gradient = <span class="hljs-literal">True</span></span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment"># reisze by actual_shape</span></span><br><span class="line">        out = fluid.layers.resize_nearest(</span><br><span class="line">            input=input,</span><br><span class="line">            scale=scale,</span><br><span class="line">            actual_shape=out_shape)</span><br><span class="line">        <span class="hljs-keyword">return</span> out</span><br><span class="line">    </span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">yolo_detection_block</span><span class="hljs-params">(self, input, num_filters)</span>:</span></span><br><span class="line">        route = self.conv_bn(input, num_filters, filter_size=<span class="hljs-number">1</span>, stride=<span class="hljs-number">1</span>, padding=<span class="hljs-number">0</span>)</span><br><span class="line">        tip = self.conv_bn(route, num_filters * <span class="hljs-number">2</span>, filter_size=<span class="hljs-number">3</span>, stride=<span class="hljs-number">1</span>, padding=<span class="hljs-number">1</span>)</span><br><span class="line">        <span class="hljs-keyword">return</span> route, tip</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">net</span><span class="hljs-params">(self, img)</span>:</span> </span><br><span class="line">        <span class="hljs-comment"># darknet-tiny</span></span><br><span class="line">        stages = [<span class="hljs-number">16</span>, <span class="hljs-number">32</span>, <span class="hljs-number">64</span>, <span class="hljs-number">128</span>, <span class="hljs-number">256</span>, <span class="hljs-number">512</span>]</span><br><span class="line">        <span class="hljs-keyword">assert</span> len(self.anchor_mask) &lt;= len(stages), <span class="hljs-string">"anchor masks can't bigger than downsample times"</span></span><br><span class="line">        <span class="hljs-comment"># 256x256</span></span><br><span class="line">        tmp = img</span><br><span class="line">        blocks = []</span><br><span class="line">        <span class="hljs-keyword">for</span> i, stage_count <span class="hljs-keyword">in</span> enumerate(stages):</span><br><span class="line">            <span class="hljs-keyword">if</span> i == len(stages) - <span class="hljs-number">1</span>:</span><br><span class="line">                block = self.conv_bn(tmp, stage_count, filter_size=<span class="hljs-number">3</span>, stride=<span class="hljs-number">1</span>, padding=<span class="hljs-number">1</span>)</span><br><span class="line">                blocks.append(block)</span><br><span class="line">                block = self.depthwise_conv_bn(blocks[<span class="hljs-number">-1</span>])</span><br><span class="line">                block = self.depthwise_conv_bn(blocks[<span class="hljs-number">-1</span>])</span><br><span class="line">                block = self.conv_bn(blocks[<span class="hljs-number">-1</span>], stage_count * <span class="hljs-number">2</span>, filter_size=<span class="hljs-number">1</span>, stride=<span class="hljs-number">1</span>, padding=<span class="hljs-number">0</span>)</span><br><span class="line">                blocks.append(block)</span><br><span class="line">            <span class="hljs-keyword">else</span>:</span><br><span class="line">                tmp = self.basicblock(tmp, stage_count)</span><br><span class="line">                blocks.append(tmp)</span><br><span class="line">        </span><br><span class="line">        blocks = [blocks[<span class="hljs-number">-1</span>], blocks[<span class="hljs-number">3</span>]]</span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment"># yolo detector</span></span><br><span class="line">        <span class="hljs-keyword">for</span> i, block <span class="hljs-keyword">in</span> enumerate(blocks):</span><br><span class="line">            <span class="hljs-comment"># yolo 中跨视域链接</span></span><br><span class="line">            <span class="hljs-keyword">if</span> i &gt; <span class="hljs-number">0</span>:</span><br><span class="line">                block = fluid.layers.concat(input=[route, block], axis=<span class="hljs-number">1</span>)</span><br><span class="line">            <span class="hljs-keyword">if</span> i &lt; <span class="hljs-number">1</span>:</span><br><span class="line">                route, tip = self.yolo_detection_block(block, num_filters=<span class="hljs-number">256</span> // (<span class="hljs-number">2</span>**i))</span><br><span class="line">            <span class="hljs-keyword">else</span>:</span><br><span class="line">                tip = self.conv_bn(block, num_filters=<span class="hljs-number">256</span>, filter_size=<span class="hljs-number">3</span>, stride=<span class="hljs-number">1</span>, padding=<span class="hljs-number">1</span>)</span><br><span class="line">            block_out = fluid.layers.conv2d(</span><br><span class="line">                input=tip,</span><br><span class="line">                num_filters=len(self.anchor_mask[i]) * (self.class_num + <span class="hljs-number">5</span>),      <span class="hljs-comment"># 5 elements represent x|y|h|w|score</span></span><br><span class="line">                filter_size=<span class="hljs-number">1</span>,</span><br><span class="line">                stride=<span class="hljs-number">1</span>,</span><br><span class="line">                padding=<span class="hljs-number">0</span>,</span><br><span class="line">                act=<span class="hljs-literal">None</span>,</span><br><span class="line">                param_attr=ParamAttr(initializer=fluid.initializer.Normal(<span class="hljs-number">0.</span>, <span class="hljs-number">0.02</span>)),</span><br><span class="line">                bias_attr=ParamAttr(initializer=fluid.initializer.Constant(<span class="hljs-number">0.0</span>), regularizer=L2Decay(<span class="hljs-number">0.</span>)))</span><br><span class="line">            self.outputs.append(block_out)</span><br><span class="line">            <span class="hljs-comment"># 为了跨视域链接，差值方式提升特征图尺寸</span></span><br><span class="line">            <span class="hljs-keyword">if</span> i &lt; len(blocks) - <span class="hljs-number">1</span>:</span><br><span class="line">                route = self.conv_bn(route, <span class="hljs-number">128</span> // (<span class="hljs-number">2</span>**i), filter_size=<span class="hljs-number">1</span>, stride=<span class="hljs-number">1</span>, padding=<span class="hljs-number">0</span>)</span><br><span class="line">                route = self.upsample(route)</span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">return</span> self.outputs</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_yolo</span><span class="hljs-params">(is_tiny, class_num, anchors, anchor_mask)</span>:</span></span><br><span class="line">    <span class="hljs-keyword">if</span> is_tiny:</span><br><span class="line">        <span class="hljs-keyword">return</span> YOLOv3Tiny(class_num, anchors, anchor_mask)</span><br><span class="line">    <span class="hljs-keyword">else</span>:</span><br><span class="line">        <span class="hljs-keyword">return</span> YOLOv3(class_num, anchors, anchor_mask)</span><br></pre></td></tr></table></figure>

<p>定义训练时候，数据增强需要的辅助类，例如外接矩形框</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Sampler</span><span class="hljs-params">(object)</span>:</span></span><br><span class="line">    <span class="hljs-string">"""</span></span><br><span class="line"><span class="hljs-string">    采样器，用于扣取采样</span></span><br><span class="line"><span class="hljs-string">    """</span></span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self, max_sample, max_trial, min_scale, max_scale,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">                 min_aspect_ratio, max_aspect_ratio, min_jaccard_overlap,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">                 max_jaccard_overlap)</span>:</span></span><br><span class="line">        <span class="hljs-string">"""</span></span><br><span class="line"><span class="hljs-string">        构造函数</span></span><br><span class="line"><span class="hljs-string">        :param max_sample:</span></span><br><span class="line"><span class="hljs-string">        :param max_trial:</span></span><br><span class="line"><span class="hljs-string">        :param min_scale:</span></span><br><span class="line"><span class="hljs-string">        :param max_scale:</span></span><br><span class="line"><span class="hljs-string">        :param min_aspect_ratio:</span></span><br><span class="line"><span class="hljs-string">        :param max_aspect_ratio:</span></span><br><span class="line"><span class="hljs-string">        :param min_jaccard_overlap:</span></span><br><span class="line"><span class="hljs-string">        :param max_jaccard_overlap:</span></span><br><span class="line"><span class="hljs-string">        """</span></span><br><span class="line">        self.max_sample = max_sample</span><br><span class="line">        self.max_trial = max_trial</span><br><span class="line">        self.min_scale = min_scale</span><br><span class="line">        self.max_scale = max_scale</span><br><span class="line">        self.min_aspect_ratio = min_aspect_ratio</span><br><span class="line">        self.max_aspect_ratio = max_aspect_ratio</span><br><span class="line">        self.min_jaccard_overlap = min_jaccard_overlap</span><br><span class="line">        self.max_jaccard_overlap = max_jaccard_overlap</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">bbox</span><span class="hljs-params">(object)</span>:</span></span><br><span class="line">    <span class="hljs-string">"""</span></span><br><span class="line"><span class="hljs-string">    外界矩形框</span></span><br><span class="line"><span class="hljs-string">    """</span></span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self, xmin, ymin, xmax, ymax)</span>:</span></span><br><span class="line">        <span class="hljs-string">"""</span></span><br><span class="line"><span class="hljs-string">        构造函数</span></span><br><span class="line"><span class="hljs-string">        :param xmin:</span></span><br><span class="line"><span class="hljs-string">        :param ymin:</span></span><br><span class="line"><span class="hljs-string">        :param xmax:</span></span><br><span class="line"><span class="hljs-string">        :param ymax:</span></span><br><span class="line"><span class="hljs-string">        """</span></span><br><span class="line">        self.xmin = xmin</span><br><span class="line">        self.ymin = ymin</span><br><span class="line">        self.xmax = xmax</span><br><span class="line">        self.ymax = ymax</span><br></pre></td></tr></table></figure>

<p>训练数据增强，主要是采样。利用随机截取训练图上的框来生成新的训练样本。同时要保证采样的样本能包含真实的目标。采样之后，为了保持训练数据格式的一致性，还需要对标注的坐标信息做变换</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">box_to_center_relative</span><span class="hljs-params">(box, img_height, img_width)</span>:</span></span><br><span class="line">    <span class="hljs-string">"""</span></span><br><span class="line"><span class="hljs-string">    Convert COCO annotations box with format [x1, y1, w, h] to </span></span><br><span class="line"><span class="hljs-string">    center mode [center_x, center_y, w, h] and divide image width</span></span><br><span class="line"><span class="hljs-string">    and height to get relative value in range[0, 1]</span></span><br><span class="line"><span class="hljs-string">    """</span></span><br><span class="line">    <span class="hljs-keyword">assert</span> len(box) == <span class="hljs-number">4</span>, <span class="hljs-string">"box should be a len(4) list or tuple"</span></span><br><span class="line">    x, y, w, h = box</span><br><span class="line"></span><br><span class="line">    x1 = max(x, <span class="hljs-number">0</span>)</span><br><span class="line">    x2 = min(x + w - <span class="hljs-number">1</span>, img_width - <span class="hljs-number">1</span>)</span><br><span class="line">    y1 = max(y, <span class="hljs-number">0</span>)</span><br><span class="line">    y2 = min(y + h - <span class="hljs-number">1</span>, img_height - <span class="hljs-number">1</span>)</span><br><span class="line"></span><br><span class="line">    x = (x1 + x2) / <span class="hljs-number">2</span> / img_width</span><br><span class="line">    y = (y1 + y2) / <span class="hljs-number">2</span> / img_height</span><br><span class="line">    w = (x2 - x1) / img_width</span><br><span class="line">    h = (y2 - y1) / img_height</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">return</span> np.array([x, y, w, h])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">resize_img</span><span class="hljs-params">(img, sampled_labels, input_size)</span>:</span></span><br><span class="line">    target_size = input_size</span><br><span class="line">    img = img.resize((target_size[<span class="hljs-number">1</span>], target_size[<span class="hljs-number">2</span>]), Image.BILINEAR)</span><br><span class="line">    <span class="hljs-keyword">return</span> img</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">box_iou_xywh</span><span class="hljs-params">(box1, box2)</span>:</span></span><br><span class="line">    <span class="hljs-keyword">assert</span> box1.shape[<span class="hljs-number">-1</span>] == <span class="hljs-number">4</span>, <span class="hljs-string">"Box1 shape[-1] should be 4."</span></span><br><span class="line">    <span class="hljs-keyword">assert</span> box2.shape[<span class="hljs-number">-1</span>] == <span class="hljs-number">4</span>, <span class="hljs-string">"Box2 shape[-1] should be 4."</span></span><br><span class="line"></span><br><span class="line">    b1_x1, b1_x2 = box1[:, <span class="hljs-number">0</span>] - box1[:, <span class="hljs-number">2</span>] / <span class="hljs-number">2</span>, box1[:, <span class="hljs-number">0</span>] + box1[:, <span class="hljs-number">2</span>] / <span class="hljs-number">2</span></span><br><span class="line">    b1_y1, b1_y2 = box1[:, <span class="hljs-number">1</span>] - box1[:, <span class="hljs-number">3</span>] / <span class="hljs-number">2</span>, box1[:, <span class="hljs-number">1</span>] + box1[:, <span class="hljs-number">3</span>] / <span class="hljs-number">2</span></span><br><span class="line">    b2_x1, b2_x2 = box2[:, <span class="hljs-number">0</span>] - box2[:, <span class="hljs-number">2</span>] / <span class="hljs-number">2</span>, box2[:, <span class="hljs-number">0</span>] + box2[:, <span class="hljs-number">2</span>] / <span class="hljs-number">2</span></span><br><span class="line">    b2_y1, b2_y2 = box2[:, <span class="hljs-number">1</span>] - box2[:, <span class="hljs-number">3</span>] / <span class="hljs-number">2</span>, box2[:, <span class="hljs-number">1</span>] + box2[:, <span class="hljs-number">3</span>] / <span class="hljs-number">2</span></span><br><span class="line"></span><br><span class="line">    inter_x1 = np.maximum(b1_x1, b2_x1)</span><br><span class="line">    inter_x2 = np.minimum(b1_x2, b2_x2)</span><br><span class="line">    inter_y1 = np.maximum(b1_y1, b2_y1)</span><br><span class="line">    inter_y2 = np.minimum(b1_y2, b2_y2)</span><br><span class="line">    inter_w = inter_x2 - inter_x1 + <span class="hljs-number">1</span></span><br><span class="line">    inter_h = inter_y2 - inter_y1 + <span class="hljs-number">1</span></span><br><span class="line">    inter_w[inter_w &lt; <span class="hljs-number">0</span>] = <span class="hljs-number">0</span></span><br><span class="line">    inter_h[inter_h &lt; <span class="hljs-number">0</span>] = <span class="hljs-number">0</span></span><br><span class="line"></span><br><span class="line">    inter_area = inter_w * inter_h</span><br><span class="line">    b1_area = (b1_x2 - b1_x1 + <span class="hljs-number">1</span>) * (b1_y2 - b1_y1 + <span class="hljs-number">1</span>)</span><br><span class="line">    b2_area = (b2_x2 - b2_x1 + <span class="hljs-number">1</span>) * (b2_y2 - b2_y1 + <span class="hljs-number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">return</span> inter_area / (b1_area + b2_area - inter_area)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">box_crop</span><span class="hljs-params">(boxes, labels, crop, img_shape)</span>:</span></span><br><span class="line">    x, y, w, h = map(float, crop)</span><br><span class="line">    im_w, im_h = map(float, img_shape)</span><br><span class="line"></span><br><span class="line">    boxes = boxes.copy()</span><br><span class="line">    boxes[:, <span class="hljs-number">0</span>], boxes[:, <span class="hljs-number">2</span>] = (boxes[:, <span class="hljs-number">0</span>] - boxes[:, <span class="hljs-number">2</span>] / <span class="hljs-number">2</span>) * im_w, (boxes[:, <span class="hljs-number">0</span>] + boxes[:, <span class="hljs-number">2</span>] / <span class="hljs-number">2</span>) * im_w</span><br><span class="line">    boxes[:, <span class="hljs-number">1</span>], boxes[:, <span class="hljs-number">3</span>] = (boxes[:, <span class="hljs-number">1</span>] - boxes[:, <span class="hljs-number">3</span>] / <span class="hljs-number">2</span>) * im_h, (boxes[:, <span class="hljs-number">1</span>] + boxes[:, <span class="hljs-number">3</span>] / <span class="hljs-number">2</span>) * im_h</span><br><span class="line"></span><br><span class="line">    crop_box = np.array([x, y, x + w, y + h])</span><br><span class="line">    centers = (boxes[:, :<span class="hljs-number">2</span>] + boxes[:, <span class="hljs-number">2</span>:]) / <span class="hljs-number">2.0</span></span><br><span class="line">    mask = np.logical_and(crop_box[:<span class="hljs-number">2</span>] &lt;= centers, centers &lt;= crop_box[<span class="hljs-number">2</span>:]).all(axis=<span class="hljs-number">1</span>)</span><br><span class="line"></span><br><span class="line">    boxes[:, :<span class="hljs-number">2</span>] = np.maximum(boxes[:, :<span class="hljs-number">2</span>], crop_box[:<span class="hljs-number">2</span>])</span><br><span class="line">    boxes[:, <span class="hljs-number">2</span>:] = np.minimum(boxes[:, <span class="hljs-number">2</span>:], crop_box[<span class="hljs-number">2</span>:])</span><br><span class="line">    boxes[:, :<span class="hljs-number">2</span>] -= crop_box[:<span class="hljs-number">2</span>]</span><br><span class="line">    boxes[:, <span class="hljs-number">2</span>:] -= crop_box[:<span class="hljs-number">2</span>]</span><br><span class="line"></span><br><span class="line">    mask = np.logical_and(mask, (boxes[:, :<span class="hljs-number">2</span>] &lt; boxes[:, <span class="hljs-number">2</span>:]).all(axis=<span class="hljs-number">1</span>))</span><br><span class="line">    boxes = boxes * np.expand_dims(mask.astype(<span class="hljs-string">'float32'</span>), axis=<span class="hljs-number">1</span>)</span><br><span class="line">    labels = labels * mask.astype(<span class="hljs-string">'float32'</span>)</span><br><span class="line">    boxes[:, <span class="hljs-number">0</span>], boxes[:, <span class="hljs-number">2</span>] = (boxes[:, <span class="hljs-number">0</span>] + boxes[:, <span class="hljs-number">2</span>]) / <span class="hljs-number">2</span> / w, (boxes[:, <span class="hljs-number">2</span>] - boxes[:, <span class="hljs-number">0</span>]) / w</span><br><span class="line">    boxes[:, <span class="hljs-number">1</span>], boxes[:, <span class="hljs-number">3</span>] = (boxes[:, <span class="hljs-number">1</span>] + boxes[:, <span class="hljs-number">3</span>]) / <span class="hljs-number">2</span> / h, (boxes[:, <span class="hljs-number">3</span>] - boxes[:, <span class="hljs-number">1</span>]) / h</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">return</span> boxes, labels, mask.sum()</span><br></pre></td></tr></table></figure>

<p>图像增强相关的函数：</p>
<ul>
<li>对比度</li>
<li>饱和度</li>
<li>明暗</li>
<li>颜色</li>
<li>扩张</li>
</ul>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">random_brightness</span><span class="hljs-params">(img)</span>:</span></span><br><span class="line">    prob = np.random.uniform(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>)</span><br><span class="line">    <span class="hljs-keyword">if</span> prob &lt; train_parameters[<span class="hljs-string">'image_distort_strategy'</span>][<span class="hljs-string">'brightness_prob'</span>]:</span><br><span class="line">        brightness_delta = train_parameters[<span class="hljs-string">'image_distort_strategy'</span>][<span class="hljs-string">'brightness_delta'</span>]</span><br><span class="line">        delta = np.random.uniform(-brightness_delta, brightness_delta) + <span class="hljs-number">1</span></span><br><span class="line">        img = ImageEnhance.Brightness(img).enhance(delta)</span><br><span class="line">    <span class="hljs-keyword">return</span> img</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">random_contrast</span><span class="hljs-params">(img)</span>:</span></span><br><span class="line">    prob = np.random.uniform(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>)</span><br><span class="line">    <span class="hljs-keyword">if</span> prob &lt; train_parameters[<span class="hljs-string">'image_distort_strategy'</span>][<span class="hljs-string">'contrast_prob'</span>]:</span><br><span class="line">        contrast_delta = train_parameters[<span class="hljs-string">'image_distort_strategy'</span>][<span class="hljs-string">'contrast_delta'</span>]</span><br><span class="line">        delta = np.random.uniform(-contrast_delta, contrast_delta) + <span class="hljs-number">1</span></span><br><span class="line">        img = ImageEnhance.Contrast(img).enhance(delta)</span><br><span class="line">    <span class="hljs-keyword">return</span> img</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">random_saturation</span><span class="hljs-params">(img)</span>:</span></span><br><span class="line">    prob = np.random.uniform(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>)</span><br><span class="line">    <span class="hljs-keyword">if</span> prob &lt; train_parameters[<span class="hljs-string">'image_distort_strategy'</span>][<span class="hljs-string">'saturation_prob'</span>]:</span><br><span class="line">        saturation_delta = train_parameters[<span class="hljs-string">'image_distort_strategy'</span>][<span class="hljs-string">'saturation_delta'</span>]</span><br><span class="line">        delta = np.random.uniform(-saturation_delta, saturation_delta) + <span class="hljs-number">1</span></span><br><span class="line">        img = ImageEnhance.Color(img).enhance(delta)</span><br><span class="line">    <span class="hljs-keyword">return</span> img</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">random_hue</span><span class="hljs-params">(img)</span>:</span></span><br><span class="line">    prob = np.random.uniform(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>)</span><br><span class="line">    <span class="hljs-keyword">if</span> prob &lt; train_parameters[<span class="hljs-string">'image_distort_strategy'</span>][<span class="hljs-string">'hue_prob'</span>]:</span><br><span class="line">        hue_delta = train_parameters[<span class="hljs-string">'image_distort_strategy'</span>][<span class="hljs-string">'hue_delta'</span>]</span><br><span class="line">        delta = np.random.uniform(-hue_delta, hue_delta)</span><br><span class="line">        img_hsv = np.array(img.convert(<span class="hljs-string">'HSV'</span>))</span><br><span class="line">        img_hsv[:, :, <span class="hljs-number">0</span>] = img_hsv[:, :, <span class="hljs-number">0</span>] + delta</span><br><span class="line">        img = Image.fromarray(img_hsv, mode=<span class="hljs-string">'HSV'</span>).convert(<span class="hljs-string">'RGB'</span>)</span><br><span class="line">    <span class="hljs-keyword">return</span> img</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">distort_image</span><span class="hljs-params">(img)</span>:</span></span><br><span class="line">    prob = np.random.uniform(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>)</span><br><span class="line">    <span class="hljs-comment"># Apply different distort order</span></span><br><span class="line">    <span class="hljs-keyword">if</span> prob &gt; <span class="hljs-number">0.5</span>:</span><br><span class="line">        img = random_brightness(img)</span><br><span class="line">        img = random_contrast(img)</span><br><span class="line">        img = random_saturation(img)</span><br><span class="line">        img = random_hue(img)</span><br><span class="line">    <span class="hljs-keyword">else</span>:</span><br><span class="line">        img = random_brightness(img)</span><br><span class="line">        img = random_saturation(img)</span><br><span class="line">        img = random_hue(img)</span><br><span class="line">        img = random_contrast(img)</span><br><span class="line">    <span class="hljs-keyword">return</span> img</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">random_crop</span><span class="hljs-params">(img, boxes, labels, scales=[<span class="hljs-number">0.3</span>, <span class="hljs-number">1.0</span>], max_ratio=<span class="hljs-number">2.0</span>, constraints=None, max_trial=<span class="hljs-number">50</span>)</span>:</span></span><br><span class="line">    <span class="hljs-keyword">if</span> random.random() &gt; <span class="hljs-number">0.6</span>:</span><br><span class="line">        <span class="hljs-keyword">return</span> img, boxes, labels</span><br><span class="line">    <span class="hljs-keyword">if</span> len(boxes) == <span class="hljs-number">0</span>:</span><br><span class="line">        <span class="hljs-keyword">return</span> img, boxes, labels</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> constraints:</span><br><span class="line">        constraints = [</span><br><span class="line">                (<span class="hljs-number">0.1</span>, <span class="hljs-number">1.0</span>),</span><br><span class="line">                (<span class="hljs-number">0.3</span>, <span class="hljs-number">1.0</span>),</span><br><span class="line">                (<span class="hljs-number">0.5</span>, <span class="hljs-number">1.0</span>),</span><br><span class="line">                (<span class="hljs-number">0.7</span>, <span class="hljs-number">1.0</span>),</span><br><span class="line">                (<span class="hljs-number">0.9</span>, <span class="hljs-number">1.0</span>),</span><br><span class="line">                (<span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>)]</span><br><span class="line"></span><br><span class="line">    w, h = img.size</span><br><span class="line">    crops = [(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, w, h)]</span><br><span class="line">    <span class="hljs-keyword">for</span> min_iou, max_iou <span class="hljs-keyword">in</span> constraints:</span><br><span class="line">        <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> range(max_trial):</span><br><span class="line">            scale = random.uniform(scales[<span class="hljs-number">0</span>], scales[<span class="hljs-number">1</span>])</span><br><span class="line">            aspect_ratio = random.uniform(max(<span class="hljs-number">1</span> / max_ratio, scale * scale), \</span><br><span class="line">                                          min(max_ratio, <span class="hljs-number">1</span> / scale / scale))</span><br><span class="line">            crop_h = int(h * scale / np.sqrt(aspect_ratio))</span><br><span class="line">            crop_w = int(w * scale * np.sqrt(aspect_ratio))</span><br><span class="line">            crop_x = random.randrange(w - crop_w)</span><br><span class="line">            crop_y = random.randrange(h - crop_h)</span><br><span class="line">            crop_box = np.array([[</span><br><span class="line">                (crop_x + crop_w / <span class="hljs-number">2.0</span>) / w,</span><br><span class="line">                (crop_y + crop_h / <span class="hljs-number">2.0</span>) / h,</span><br><span class="line">                crop_w / float(w),</span><br><span class="line">                crop_h /float(h)</span><br><span class="line">                ]])</span><br><span class="line"></span><br><span class="line">            iou = box_iou_xywh(crop_box, boxes)</span><br><span class="line">            <span class="hljs-keyword">if</span> min_iou &lt;= iou.min() <span class="hljs-keyword">and</span> max_iou &gt;= iou.max():</span><br><span class="line">                crops.append((crop_x, crop_y, crop_w, crop_h))</span><br><span class="line">                <span class="hljs-keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">while</span> crops:</span><br><span class="line">        crop = crops.pop(np.random.randint(<span class="hljs-number">0</span>, len(crops)))</span><br><span class="line">        crop_boxes, crop_labels, box_num = box_crop(boxes, labels, crop, (w, h))</span><br><span class="line">        <span class="hljs-keyword">if</span> box_num &lt; <span class="hljs-number">1</span>:</span><br><span class="line">            <span class="hljs-keyword">continue</span></span><br><span class="line">        img = img.crop((crop[<span class="hljs-number">0</span>], crop[<span class="hljs-number">1</span>], crop[<span class="hljs-number">0</span>] + crop[<span class="hljs-number">2</span>], </span><br><span class="line">                        crop[<span class="hljs-number">1</span>] + crop[<span class="hljs-number">3</span>])).resize(img.size, Image.LANCZOS)</span><br><span class="line">        <span class="hljs-keyword">return</span> img, crop_boxes, crop_labels</span><br><span class="line">    <span class="hljs-keyword">return</span> img, boxes, labels</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">random_expand</span><span class="hljs-params">(img, gtboxes, keep_ratio=True)</span>:</span></span><br><span class="line">    <span class="hljs-keyword">if</span> np.random.uniform(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>) &lt; train_parameters[<span class="hljs-string">'image_distort_strategy'</span>][<span class="hljs-string">'expand_prob'</span>]:</span><br><span class="line">        <span class="hljs-keyword">return</span> img, gtboxes</span><br><span class="line"></span><br><span class="line">    max_ratio = train_parameters[<span class="hljs-string">'image_distort_strategy'</span>][<span class="hljs-string">'expand_max_ratio'</span>]    </span><br><span class="line">    w, h = img.size</span><br><span class="line">    c = <span class="hljs-number">3</span></span><br><span class="line">    ratio_x = random.uniform(<span class="hljs-number">1</span>, max_ratio)</span><br><span class="line">    <span class="hljs-keyword">if</span> keep_ratio:</span><br><span class="line">        ratio_y = ratio_x</span><br><span class="line">    <span class="hljs-keyword">else</span>:</span><br><span class="line">        ratio_y = random.uniform(<span class="hljs-number">1</span>, max_ratio)</span><br><span class="line">    oh = int(h * ratio_y)</span><br><span class="line">    ow = int(w * ratio_x)</span><br><span class="line">    off_x = random.randint(<span class="hljs-number">0</span>, ow -w)</span><br><span class="line">    off_y = random.randint(<span class="hljs-number">0</span>, oh -h)</span><br><span class="line"></span><br><span class="line">    out_img = np.zeros((oh, ow, c), np.uint8)</span><br><span class="line">    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(c):</span><br><span class="line">        out_img[:, :, i] = train_parameters[<span class="hljs-string">'mean_rgb'</span>][i]</span><br><span class="line"></span><br><span class="line">    out_img[off_y: off_y + h, off_x: off_x + w, :] = img</span><br><span class="line">    gtboxes[:, <span class="hljs-number">0</span>] = ((gtboxes[:, <span class="hljs-number">0</span>] * w) + off_x) / float(ow)</span><br><span class="line">    gtboxes[:, <span class="hljs-number">1</span>] = ((gtboxes[:, <span class="hljs-number">1</span>] * h) + off_y) / float(oh)</span><br><span class="line">    gtboxes[:, <span class="hljs-number">2</span>] = gtboxes[:, <span class="hljs-number">2</span>] / ratio_x</span><br><span class="line">    gtboxes[:, <span class="hljs-number">3</span>] = gtboxes[:, <span class="hljs-number">3</span>] / ratio_y</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">return</span> Image.fromarray(out_img), gtboxes</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">preprocess</span><span class="hljs-params">(img, bbox_labels, input_size, mode)</span>:</span></span><br><span class="line">    img_width, img_height = img.size</span><br><span class="line">    sample_labels = np.array(bbox_labels)</span><br><span class="line">    <span class="hljs-keyword">if</span> mode == <span class="hljs-string">'train'</span>:</span><br><span class="line">        <span class="hljs-keyword">if</span> train_parameters[<span class="hljs-string">'apply_distort'</span>]:</span><br><span class="line">            img = distort_image(img)</span><br><span class="line">        img, gtboxes = random_expand(img, sample_labels[:, <span class="hljs-number">1</span>:<span class="hljs-number">5</span>])</span><br><span class="line">        img, gtboxes, gtlabels = random_crop(img, gtboxes, sample_labels[:, <span class="hljs-number">0</span>])</span><br><span class="line">        sample_labels[:, <span class="hljs-number">0</span>] = gtlabels</span><br><span class="line">        sample_labels[:, <span class="hljs-number">1</span>:<span class="hljs-number">5</span>] = gtboxes</span><br><span class="line">    img = resize_img(img, sample_labels, input_size)</span><br><span class="line">    img = np.array(img).astype(<span class="hljs-string">'float32'</span>)</span><br><span class="line">    img -= train_parameters[<span class="hljs-string">'mean_rgb'</span>]</span><br><span class="line">    img = img.transpose((<span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>))  <span class="hljs-comment"># HWC to CHW</span></span><br><span class="line">    img *= <span class="hljs-number">0.007843</span></span><br><span class="line">    <span class="hljs-keyword">return</span> img, sample_labels</span><br></pre></td></tr></table></figure>

<h1 id="数据读取器"><a href="#数据读取器" class="headerlink" title="数据读取器"></a>数据读取器</h1><p>自定义数据读取器，如果需要自定义数据，需要修改下面这段函数，以适配自定义数据的格式</p>
<p>此外还定义了训练时候的读取方式，有同步的读取器，也有异步的读取器</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">custom_reader</span><span class="hljs-params">(file_list, data_dir, input_size, mode)</span>:</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">reader</span><span class="hljs-params">()</span>:</span></span><br><span class="line">        np.random.shuffle(file_list)</span><br><span class="line">        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> file_list:</span><br><span class="line">            <span class="hljs-keyword">if</span> mode == <span class="hljs-string">'train'</span> <span class="hljs-keyword">or</span> mode == <span class="hljs-string">'eval'</span>:</span><br><span class="line">                <span class="hljs-comment">######################  以下可能是需要自定义修改的部分   ############################</span></span><br><span class="line">                parts = line.split(<span class="hljs-string">'\t'</span>)</span><br><span class="line">                image_path = parts[<span class="hljs-number">0</span>]</span><br><span class="line">                img = Image.open(os.path.join(data_dir, image_path))</span><br><span class="line">                <span class="hljs-keyword">if</span> img.mode != <span class="hljs-string">'RGB'</span>:</span><br><span class="line">                    img = img.convert(<span class="hljs-string">'RGB'</span>)</span><br><span class="line">                im_width, im_height = img.size</span><br><span class="line">                <span class="hljs-comment"># bbox 的列表，每一个元素为这样</span></span><br><span class="line">                <span class="hljs-comment"># layout: label | x-center | y-cneter | width | height | difficult</span></span><br><span class="line">                bbox_labels = []</span><br><span class="line">                <span class="hljs-keyword">for</span> object_str <span class="hljs-keyword">in</span> parts[<span class="hljs-number">1</span>:]:</span><br><span class="line">                    <span class="hljs-keyword">if</span> len(object_str) &lt;= <span class="hljs-number">1</span>:</span><br><span class="line">                        <span class="hljs-keyword">continue</span></span><br><span class="line">                    bbox_sample = []</span><br><span class="line">                    object = json.loads(object_str)</span><br><span class="line">                    bbox_sample.append(float(train_parameters[<span class="hljs-string">'label_dict'</span>][object[<span class="hljs-string">'value'</span>]]))</span><br><span class="line">                    bbox = object[<span class="hljs-string">'coordinate'</span>]</span><br><span class="line">                    box = [bbox[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>], bbox[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>], bbox[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>] - bbox[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>], bbox[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>] - bbox[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>]]</span><br><span class="line">                    bbox = box_to_center_relative(box, im_height, im_width)</span><br><span class="line">                    bbox_sample.append(float(bbox[<span class="hljs-number">0</span>]))</span><br><span class="line">                    bbox_sample.append(float(bbox[<span class="hljs-number">1</span>]))</span><br><span class="line">                    bbox_sample.append(float(bbox[<span class="hljs-number">2</span>]))</span><br><span class="line">                    bbox_sample.append(float(bbox[<span class="hljs-number">3</span>]))</span><br><span class="line">                    difficult = float(<span class="hljs-number">0</span>)</span><br><span class="line">                    bbox_sample.append(difficult)</span><br><span class="line">                    bbox_labels.append(bbox_sample)</span><br><span class="line">                <span class="hljs-comment">######################  可能需要自定义修改部分结束   ############################</span></span><br><span class="line">                <span class="hljs-keyword">if</span> len(bbox_labels) == <span class="hljs-number">0</span>: <span class="hljs-keyword">continue</span></span><br><span class="line">                img, sample_labels = preprocess(img, bbox_labels, input_size, mode)</span><br><span class="line">                <span class="hljs-comment"># sample_labels = np.array(sample_labels)</span></span><br><span class="line">                <span class="hljs-keyword">if</span> len(sample_labels) == <span class="hljs-number">0</span>: <span class="hljs-keyword">continue</span></span><br><span class="line">                boxes = sample_labels[:, <span class="hljs-number">1</span>:<span class="hljs-number">5</span>]</span><br><span class="line">                lbls = sample_labels[:, <span class="hljs-number">0</span>].astype(<span class="hljs-string">'int32'</span>)</span><br><span class="line">                difficults = sample_labels[:, <span class="hljs-number">-1</span>].astype(<span class="hljs-string">'int32'</span>)</span><br><span class="line">                max_box_num = train_parameters[<span class="hljs-string">'max_box_num'</span>]</span><br><span class="line">                cope_size = max_box_num <span class="hljs-keyword">if</span> len(boxes) &gt;= max_box_num <span class="hljs-keyword">else</span> len(boxes)</span><br><span class="line">                ret_boxes = np.zeros((max_box_num, <span class="hljs-number">4</span>), dtype=np.float32)</span><br><span class="line">                ret_lbls = np.zeros((max_box_num), dtype=np.int32)</span><br><span class="line">                ret_difficults = np.zeros((max_box_num), dtype=np.int32)</span><br><span class="line">                ret_boxes[<span class="hljs-number">0</span>: cope_size] = boxes[<span class="hljs-number">0</span>: cope_size]</span><br><span class="line">                ret_lbls[<span class="hljs-number">0</span>: cope_size] = lbls[<span class="hljs-number">0</span>: cope_size]</span><br><span class="line">                ret_difficults[<span class="hljs-number">0</span>: cope_size] = difficults[<span class="hljs-number">0</span>: cope_size]</span><br><span class="line">                <span class="hljs-keyword">yield</span> img, ret_boxes, ret_lbls</span><br><span class="line">            <span class="hljs-keyword">elif</span> mode == <span class="hljs-string">'test'</span>:</span><br><span class="line">                img_path = os.path.join(line)</span><br><span class="line">                <span class="hljs-keyword">yield</span> Image.open(img_path)</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">return</span> reader</span><br></pre></td></tr></table></figure>

<h1 id="定义优化器"><a href="#定义优化器" class="headerlink" title="定义优化器"></a>定义优化器</h1><ul>
<li>定义同步数据读取</li>
<li>定义优化器</li>
<li>构建 program 和损失函数</li>
</ul>
<p>注意yolo_loss里面，smooth_label 选项默认为 True，如果类别较少的情况下，建议置为 False</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">single_custom_reader</span><span class="hljs-params">(file_path, data_dir, input_size, mode)</span>:</span></span><br><span class="line">    file_path = os.path.join(data_dir, file_path)</span><br><span class="line">    images = [line.strip() <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> open(file_path)]</span><br><span class="line">    reader = custom_reader(images, data_dir, input_size, mode)</span><br><span class="line">    reader = paddle.reader.shuffle(reader, train_parameters[<span class="hljs-string">'train_batch_size'</span>])</span><br><span class="line">    reader = paddle.batch(reader, train_parameters[<span class="hljs-string">'train_batch_size'</span>])</span><br><span class="line">    <span class="hljs-keyword">return</span> reader</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">optimizer_sgd_setting</span><span class="hljs-params">()</span>:</span></span><br><span class="line">    batch_size = train_parameters[<span class="hljs-string">"train_batch_size"</span>]</span><br><span class="line">    iters = train_parameters[<span class="hljs-string">"image_count"</span>] // batch_size</span><br><span class="line">    iters = <span class="hljs-number">1</span> <span class="hljs-keyword">if</span> iters &lt; <span class="hljs-number">1</span> <span class="hljs-keyword">else</span> iters</span><br><span class="line">    learning_strategy = train_parameters[<span class="hljs-string">'sgd_strategy'</span>]</span><br><span class="line">    lr = learning_strategy[<span class="hljs-string">'learning_rate'</span>]</span><br><span class="line"></span><br><span class="line">    boundaries = [i * iters <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> learning_strategy[<span class="hljs-string">"lr_epochs"</span>]]</span><br><span class="line">    values = [i * lr <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> learning_strategy[<span class="hljs-string">"lr_decay"</span>]]</span><br><span class="line">    logger.info(<span class="hljs-string">"origin learning rate: &#123;0&#125; boundaries: &#123;1&#125;  values: &#123;2&#125;"</span>.format(lr, boundaries, values))</span><br><span class="line"></span><br><span class="line">    optimizer = fluid.optimizer.SGDOptimizer(</span><br><span class="line">        learning_rate=fluid.layers.piecewise_decay(boundaries, values),</span><br><span class="line">        <span class="hljs-comment"># learning_rate=lr,</span></span><br><span class="line">        regularization=fluid.regularizer.L2Decay(<span class="hljs-number">0.00005</span>))</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">return</span> optimizer</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">build_program_with_feeder</span><span class="hljs-params">(main_prog, startup_prog, place)</span>:</span></span><br><span class="line">    max_box_num = train_parameters[<span class="hljs-string">'max_box_num'</span>]</span><br><span class="line">    ues_tiny = train_parameters[<span class="hljs-string">'use_tiny'</span>]</span><br><span class="line">    yolo_config = train_parameters[<span class="hljs-string">'yolo_tiny_cfg'</span>] <span class="hljs-keyword">if</span> ues_tiny <span class="hljs-keyword">else</span> train_parameters[<span class="hljs-string">'yolo_cfg'</span>]</span><br><span class="line">    <span class="hljs-keyword">with</span> fluid.program_guard(main_prog, startup_prog):</span><br><span class="line">        img = fluid.layers.data(name=<span class="hljs-string">'img'</span>, shape=yolo_config[<span class="hljs-string">'input_size'</span>], dtype=<span class="hljs-string">'float32'</span>)</span><br><span class="line">        gt_box = fluid.layers.data(name=<span class="hljs-string">'gt_box'</span>, shape=[max_box_num, <span class="hljs-number">4</span>], dtype=<span class="hljs-string">'float32'</span>)</span><br><span class="line">        gt_label = fluid.layers.data(name=<span class="hljs-string">'gt_label'</span>, shape=[max_box_num], dtype=<span class="hljs-string">'int32'</span>)</span><br><span class="line">        feeder = fluid.DataFeeder(feed_list=[img, gt_box, gt_label], place=place, program=main_prog)</span><br><span class="line">        reader = single_custom_reader(train_parameters[<span class="hljs-string">'train_list'</span>],</span><br><span class="line">                                    train_parameters[<span class="hljs-string">'data_dir'</span>],</span><br><span class="line">                                    yolo_config[<span class="hljs-string">'input_size'</span>], <span class="hljs-string">'train'</span>)</span><br><span class="line">        ues_tiny = train_parameters[<span class="hljs-string">'use_tiny'</span>]</span><br><span class="line">        yolo_config = train_parameters[<span class="hljs-string">'yolo_tiny_cfg'</span>] <span class="hljs-keyword">if</span> ues_tiny <span class="hljs-keyword">else</span> train_parameters[<span class="hljs-string">'yolo_cfg'</span>]</span><br><span class="line">        <span class="hljs-keyword">with</span> fluid.unique_name.guard():</span><br><span class="line">            model = get_yolo(ues_tiny, train_parameters[<span class="hljs-string">'class_dim'</span>], yolo_config[<span class="hljs-string">'anchors'</span>], yolo_config[<span class="hljs-string">'anchor_mask'</span>])</span><br><span class="line">            outputs = model.net(img)</span><br><span class="line">        <span class="hljs-keyword">return</span> feeder, reader, get_loss(model, outputs, gt_box, gt_label)</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_loss</span><span class="hljs-params">(model, outputs, gt_box, gt_label)</span>:</span></span><br><span class="line">    losses = []</span><br><span class="line">    downsample_ratio = model.get_downsample_ratio()</span><br><span class="line">    <span class="hljs-keyword">with</span> fluid.unique_name.guard(<span class="hljs-string">'train'</span>):</span><br><span class="line">        <span class="hljs-keyword">for</span> i, out <span class="hljs-keyword">in</span> enumerate(outputs):</span><br><span class="line">            loss = fluid.layers.yolov3_loss(</span><br><span class="line">                x=out,</span><br><span class="line">                gt_box=gt_box,</span><br><span class="line">                gt_label=gt_label,</span><br><span class="line">                anchors=model.get_anchors(),</span><br><span class="line">                anchor_mask=model.get_anchor_mask()[i],</span><br><span class="line">                class_num=model.get_class_num(),</span><br><span class="line">                ignore_thresh=train_parameters[<span class="hljs-string">'ignore_thresh'</span>],</span><br><span class="line">                use_label_smooth=<span class="hljs-literal">False</span>,  <span class="hljs-comment"># 对于类别不多的情况，设置为 False 会更合适一些，不然 score 会很小</span></span><br><span class="line">                downsample_ratio=downsample_ratio)</span><br><span class="line">            losses.append(fluid.layers.reduce_mean(loss))</span><br><span class="line">            downsample_ratio //= <span class="hljs-number">2</span></span><br><span class="line">        loss = sum(losses)</span><br><span class="line">        optimizer = optimizer_sgd_setting()</span><br><span class="line">        optimizer.minimize(loss)</span><br><span class="line">        <span class="hljs-keyword">return</span> loss</span><br></pre></td></tr></table></figure>

<h1 id="加载已经有的参数"><a href="#加载已经有的参数" class="headerlink" title="加载已经有的参数"></a>加载已经有的参数</h1><figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">load_pretrained_params</span><span class="hljs-params">(exe, program)</span>:</span></span><br><span class="line">    <span class="hljs-keyword">if</span> train_parameters[<span class="hljs-string">'continue_train'</span>] <span class="hljs-keyword">and</span> os.path.exists(train_parameters[<span class="hljs-string">'save_model_dir'</span>]):</span><br><span class="line">        logger.info(<span class="hljs-string">'load param from retrain model'</span>)</span><br><span class="line">        fluid.io.load_persistables(executor=exe,</span><br><span class="line">                                   dirname=train_parameters[<span class="hljs-string">'save_model_dir'</span>],</span><br><span class="line">                                   main_program=program)</span><br><span class="line">    <span class="hljs-keyword">elif</span> train_parameters[<span class="hljs-string">'pretrained'</span>] <span class="hljs-keyword">and</span> os.path.exists(train_parameters[<span class="hljs-string">'pretrained_model_dir'</span>]):</span><br><span class="line">        logger.info(<span class="hljs-string">'load param from pretrained model'</span>)</span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">if_exist</span><span class="hljs-params">(var)</span>:</span></span><br><span class="line">            <span class="hljs-keyword">return</span> os.path.exists(os.path.join(train_parameters[<span class="hljs-string">'pretrained_model_dir'</span>], var.name))</span><br><span class="line"></span><br><span class="line">        fluid.io.load_vars(exe, train_parameters[<span class="hljs-string">'pretrained_model_dir'</span>], main_program=program,</span><br><span class="line">                           predicate=if_exist)</span><br></pre></td></tr></table></figure>

<h1 id="训练主体，开始愉快的炼丹吧"><a href="#训练主体，开始愉快的炼丹吧" class="headerlink" title="训练主体，开始愉快的炼丹吧~"></a>训练主体，开始愉快的炼丹吧~</h1><p>当前日志默认输出到日志文件中，刷新左侧文件显示，能看到在 logs 目录下。可以在编辑区上方【终端】里输入如下命令看到滚动的日志</p>
<figure class="highlight shell hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tailf logs/train.log</span><br></pre></td></tr></table></figure>

<p>为了演示，此处并没有训练很多轮，如果需要得到较好的效果，可以增加训练轮数</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">train</span><span class="hljs-params">()</span>:</span></span><br><span class="line">    init_log_config()</span><br><span class="line">    init_train_parameters()</span><br><span class="line">    logger.info(<span class="hljs-string">"start train YOLOv3, train params:%s"</span>, str(train_parameters))</span><br><span class="line"></span><br><span class="line">    logger.info(<span class="hljs-string">"create place, use gpu:"</span> + str(train_parameters[<span class="hljs-string">'use_gpu'</span>]))</span><br><span class="line">    place = fluid.CUDAPlace(<span class="hljs-number">0</span>) <span class="hljs-keyword">if</span> train_parameters[<span class="hljs-string">'use_gpu'</span>] <span class="hljs-keyword">else</span> fluid.CPUPlace()</span><br><span class="line"></span><br><span class="line">    logger.info(<span class="hljs-string">"build network and program"</span>)</span><br><span class="line">    train_program = fluid.Program()</span><br><span class="line">    start_program = fluid.Program()</span><br><span class="line">    feeder, reader, loss = build_program_with_feeder(train_program, start_program, place)</span><br><span class="line"></span><br><span class="line">    logger.info(<span class="hljs-string">"build executor and init params"</span>)</span><br><span class="line">    exe = fluid.Executor(place)</span><br><span class="line">    exe.run(start_program)</span><br><span class="line">    train_fetch_list = [loss.name]</span><br><span class="line">    load_pretrained_params(exe, train_program)</span><br><span class="line"></span><br><span class="line">    stop_strategy = train_parameters[<span class="hljs-string">'early_stop'</span>]</span><br><span class="line">    successive_limit = stop_strategy[<span class="hljs-string">'successive_limit'</span>]</span><br><span class="line">    sample_freq = stop_strategy[<span class="hljs-string">'sample_frequency'</span>]</span><br><span class="line">    min_curr_map = stop_strategy[<span class="hljs-string">'min_curr_map'</span>]</span><br><span class="line">    min_loss = stop_strategy[<span class="hljs-string">'min_loss'</span>]</span><br><span class="line">    stop_train = <span class="hljs-literal">False</span></span><br><span class="line">    successive_count = <span class="hljs-number">0</span></span><br><span class="line">    total_batch_count = <span class="hljs-number">0</span></span><br><span class="line">    valid_thresh = train_parameters[<span class="hljs-string">'valid_thresh'</span>]</span><br><span class="line">    nms_thresh = train_parameters[<span class="hljs-string">'nms_thresh'</span>]</span><br><span class="line">    current_best_loss = <span class="hljs-number">10000000000.0</span></span><br><span class="line">    <span class="hljs-keyword">for</span> pass_id <span class="hljs-keyword">in</span> range(train_parameters[<span class="hljs-string">"num_epochs"</span>]):</span><br><span class="line">        logger.info(<span class="hljs-string">"current pass: &#123;&#125;, start read image"</span>.format(pass_id))</span><br><span class="line">        batch_id = <span class="hljs-number">0</span></span><br><span class="line">        total_loss = <span class="hljs-number">0.0</span></span><br><span class="line">        <span class="hljs-keyword">for</span> batch_id, data <span class="hljs-keyword">in</span> enumerate(reader()):</span><br><span class="line">            t1 = time.time()</span><br><span class="line">            loss = exe.run(train_program, feed=feeder.feed(data), fetch_list=train_fetch_list)</span><br><span class="line">            period = time.time() - t1</span><br><span class="line">            loss = np.mean(np.array(loss))</span><br><span class="line">            total_loss += loss</span><br><span class="line">            batch_id += <span class="hljs-number">1</span></span><br><span class="line">            total_batch_count += <span class="hljs-number">1</span></span><br><span class="line"></span><br><span class="line">            <span class="hljs-keyword">if</span> batch_id % <span class="hljs-number">10</span> == <span class="hljs-number">0</span>:      <span class="hljs-comment"># 调整日志输出的频率</span></span><br><span class="line">                logger.info(<span class="hljs-string">"pass &#123;&#125;, trainbatch &#123;&#125;, loss &#123;&#125; time &#123;&#125;"</span>.format(pass_id, batch_id, loss, <span class="hljs-string">"%2.2f sec"</span> % period))</span><br><span class="line">        pass_mean_loss = total_loss / batch_id</span><br><span class="line">        logger.info(<span class="hljs-string">"pass &#123;0&#125; train result, current pass mean loss: &#123;1&#125;"</span>.format(pass_id, pass_mean_loss))</span><br><span class="line">        <span class="hljs-comment"># 采用每训练完一轮停止办法，可以调整为更精细的保存策略</span></span><br><span class="line">        <span class="hljs-keyword">if</span> pass_mean_loss &lt; current_best_loss:</span><br><span class="line">            logger.info(<span class="hljs-string">"temp save &#123;&#125; epcho train result, current best pass loss &#123;&#125;"</span>.format(pass_id, pass_mean_loss))</span><br><span class="line">            fluid.io.save_persistables(dirname=train_parameters[<span class="hljs-string">'save_model_dir'</span>], main_program=train_program, executor=exe)</span><br><span class="line">            current_best_loss = pass_mean_loss</span><br><span class="line"></span><br><span class="line">    logger.info(<span class="hljs-string">"training till last epcho, end training"</span>)</span><br><span class="line">    fluid.io.save_persistables(dirname=train_parameters[<span class="hljs-string">'save_model_dir'</span>], main_program=train_program, executor=exe)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:</span><br><span class="line">    train()</span><br></pre></td></tr></table></figure>

<p>#<br>固化保存模型</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">import</span> paddle</span><br><span class="line"><span class="hljs-keyword">import</span> paddle.fluid <span class="hljs-keyword">as</span> fluid</span><br><span class="line"><span class="hljs-keyword">import</span> codecs</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">init_train_parameters()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">freeze_model</span><span class="hljs-params">()</span>:</span></span><br><span class="line"></span><br><span class="line">    exe = fluid.Executor(fluid.CPUPlace())</span><br><span class="line">    ues_tiny = train_parameters[<span class="hljs-string">'use_tiny'</span>]</span><br><span class="line">    yolo_config = train_parameters[<span class="hljs-string">'yolo_tiny_cfg'</span>] <span class="hljs-keyword">if</span> ues_tiny <span class="hljs-keyword">else</span> train_parameters[<span class="hljs-string">'yolo_cfg'</span>]</span><br><span class="line">    path = train_parameters[<span class="hljs-string">'save_model_dir'</span>]</span><br><span class="line">    model = get_yolo(ues_tiny, train_parameters[<span class="hljs-string">'class_dim'</span>], yolo_config[<span class="hljs-string">'anchors'</span>], yolo_config[<span class="hljs-string">'anchor_mask'</span>])</span><br><span class="line">    image = fluid.layers.data(name=<span class="hljs-string">'image'</span>, shape=yolo_config[<span class="hljs-string">'input_size'</span>], dtype=<span class="hljs-string">'float32'</span>)</span><br><span class="line">    image_shape = fluid.layers.data(name=<span class="hljs-string">"image_shape"</span>, shape=[<span class="hljs-number">2</span>], dtype=<span class="hljs-string">'int32'</span>)</span><br><span class="line"></span><br><span class="line">    boxes = []</span><br><span class="line">    scores = []</span><br><span class="line">    outputs = model.net(image)</span><br><span class="line">    downsample_ratio = model.get_downsample_ratio()</span><br><span class="line">    <span class="hljs-keyword">for</span> i, out <span class="hljs-keyword">in</span> enumerate(outputs):</span><br><span class="line">        box, score = fluid.layers.yolo_box(</span><br><span class="line">            x=out,</span><br><span class="line">            img_size=image_shape,</span><br><span class="line">            anchors=model.get_yolo_anchors()[i],</span><br><span class="line">            class_num=model.get_class_num(),</span><br><span class="line">            conf_thresh=train_parameters[<span class="hljs-string">'valid_thresh'</span>],</span><br><span class="line">            downsample_ratio=downsample_ratio,</span><br><span class="line">            name=<span class="hljs-string">"yolo_box_"</span> + str(i))</span><br><span class="line">        boxes.append(box)</span><br><span class="line">        scores.append(fluid.layers.transpose(score, perm=[<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>]))</span><br><span class="line">        downsample_ratio //= <span class="hljs-number">2</span></span><br><span class="line"></span><br><span class="line">    pred = fluid.layers.multiclass_nms(</span><br><span class="line">        bboxes=fluid.layers.concat(boxes, axis=<span class="hljs-number">1</span>),</span><br><span class="line">        scores=fluid.layers.concat(scores, axis=<span class="hljs-number">2</span>),</span><br><span class="line">        score_threshold=train_parameters[<span class="hljs-string">'valid_thresh'</span>],</span><br><span class="line">        nms_top_k=train_parameters[<span class="hljs-string">'nms_top_k'</span>],</span><br><span class="line">        keep_top_k=train_parameters[<span class="hljs-string">'nms_pos_k'</span>],</span><br><span class="line">        nms_threshold=train_parameters[<span class="hljs-string">'nms_thresh'</span>],</span><br><span class="line">        background_label=<span class="hljs-number">-1</span>,</span><br><span class="line">        name=<span class="hljs-string">"multiclass_nms"</span>)</span><br><span class="line"></span><br><span class="line">    freeze_program = fluid.default_main_program()</span><br><span class="line">    fluid.io.load_persistables(exe, path, freeze_program)</span><br><span class="line">    freeze_program = freeze_program.clone(for_test=<span class="hljs-literal">True</span>)</span><br><span class="line">    print(<span class="hljs-string">"freeze out: &#123;0&#125;, pred layout: &#123;1&#125;"</span>.format(train_parameters[<span class="hljs-string">'freeze_dir'</span>], pred))</span><br><span class="line">    fluid.io.save_inference_model(train_parameters[<span class="hljs-string">'freeze_dir'</span>], [<span class="hljs-string">'image'</span>, <span class="hljs-string">'image_shape'</span>], pred, exe, freeze_program)</span><br><span class="line">    print(<span class="hljs-string">"freeze end"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:</span><br><span class="line">    freeze_model()</span><br></pre></td></tr></table></figure>

<p>#<br>加载固化的模型进行预测</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="hljs-keyword">import</span> codecs</span><br><span class="line"><span class="hljs-keyword">import</span> sys</span><br><span class="line"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np</span><br><span class="line"><span class="hljs-keyword">import</span> time</span><br><span class="line"><span class="hljs-keyword">import</span> paddle</span><br><span class="line"><span class="hljs-keyword">import</span> paddle.fluid <span class="hljs-keyword">as</span> fluid</span><br><span class="line"><span class="hljs-keyword">import</span> math</span><br><span class="line"><span class="hljs-keyword">import</span> functools</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">from</span> IPython.display <span class="hljs-keyword">import</span> display</span><br><span class="line"><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image</span><br><span class="line"><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> ImageFont</span><br><span class="line"><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> ImageDraw</span><br><span class="line"><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> namedtuple</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">init_train_parameters()</span><br><span class="line">ues_tiny = train_parameters[<span class="hljs-string">'use_tiny'</span>]</span><br><span class="line">yolo_config = train_parameters[<span class="hljs-string">'yolo_tiny_cfg'</span>] <span class="hljs-keyword">if</span> ues_tiny <span class="hljs-keyword">else</span> train_parameters[<span class="hljs-string">'yolo_cfg'</span>]</span><br><span class="line"></span><br><span class="line">target_size = yolo_config[<span class="hljs-string">'input_size'</span>]</span><br><span class="line">anchors = yolo_config[<span class="hljs-string">'anchors'</span>]</span><br><span class="line">anchor_mask = yolo_config[<span class="hljs-string">'anchor_mask'</span>]</span><br><span class="line">label_dict = train_parameters[<span class="hljs-string">'num_dict'</span>]</span><br><span class="line">class_dim = train_parameters[<span class="hljs-string">'class_dim'</span>]</span><br><span class="line">print(<span class="hljs-string">"label_dict:&#123;&#125; class dim:&#123;&#125;"</span>.format(label_dict, class_dim))</span><br><span class="line">place = fluid.CUDAPlace(<span class="hljs-number">0</span>) <span class="hljs-keyword">if</span> train_parameters[<span class="hljs-string">'use_gpu'</span>] <span class="hljs-keyword">else</span> fluid.CPUPlace()</span><br><span class="line">exe = fluid.Executor(place)</span><br><span class="line">path = train_parameters[<span class="hljs-string">'freeze_dir'</span>]</span><br><span class="line">[inference_program, feed_target_names, fetch_targets] = fluid.io.load_inference_model(dirname=path, executor=exe)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">draw_bbox_image</span><span class="hljs-params">(img, boxes, labels, save_name)</span>:</span></span><br><span class="line">    <span class="hljs-string">"""</span></span><br><span class="line"><span class="hljs-string">    给图片画上外接矩形框</span></span><br><span class="line"><span class="hljs-string">    :param img:</span></span><br><span class="line"><span class="hljs-string">    :param boxes:</span></span><br><span class="line"><span class="hljs-string">    :param save_name:</span></span><br><span class="line"><span class="hljs-string">    :param labels</span></span><br><span class="line"><span class="hljs-string">    :return:</span></span><br><span class="line"><span class="hljs-string">    """</span></span><br><span class="line"></span><br><span class="line">    img_width, img_height = img.size</span><br><span class="line">    draw = ImageDraw.Draw(img)</span><br><span class="line">    <span class="hljs-keyword">for</span> box, label <span class="hljs-keyword">in</span> zip(boxes, labels):</span><br><span class="line">        xmin, ymin, xmax, ymax = box[<span class="hljs-number">0</span>], box[<span class="hljs-number">1</span>], box[<span class="hljs-number">2</span>], box[<span class="hljs-number">3</span>]</span><br><span class="line">        draw.rectangle((xmin, ymin, xmax, ymax), <span class="hljs-literal">None</span>, <span class="hljs-string">'red'</span>)</span><br><span class="line">        draw.text((xmin, ymin), label_dict[int(label)], (<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0</span>))</span><br><span class="line">    img.save(save_name)</span><br><span class="line">    display(img)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">resize_img</span><span class="hljs-params">(img, target_size)</span>:</span></span><br><span class="line">    <span class="hljs-string">"""</span></span><br><span class="line"><span class="hljs-string">    保持比例的缩放图片</span></span><br><span class="line"><span class="hljs-string">    :param img:</span></span><br><span class="line"><span class="hljs-string">    :param target_size:</span></span><br><span class="line"><span class="hljs-string">    :return:</span></span><br><span class="line"><span class="hljs-string">    """</span></span><br><span class="line">    img = img.resize(target_size[<span class="hljs-number">1</span>:], Image.BILINEAR)</span><br><span class="line">    <span class="hljs-keyword">return</span> img</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">read_image</span><span class="hljs-params">(img_path)</span>:</span></span><br><span class="line">    <span class="hljs-string">"""</span></span><br><span class="line"><span class="hljs-string">    读取图片</span></span><br><span class="line"><span class="hljs-string">    :param img_path:</span></span><br><span class="line"><span class="hljs-string">    :return:</span></span><br><span class="line"><span class="hljs-string">    """</span></span><br><span class="line">    origin = Image.open(img_path)</span><br><span class="line">    img = resize_img(origin, target_size)</span><br><span class="line">    resized_img = img.copy()</span><br><span class="line">    <span class="hljs-keyword">if</span> img.mode != <span class="hljs-string">'RGB'</span>:</span><br><span class="line">        img = img.convert(<span class="hljs-string">'RGB'</span>)</span><br><span class="line">    img = np.array(img).astype(<span class="hljs-string">'float32'</span>).transpose((<span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>))  <span class="hljs-comment"># HWC to CHW</span></span><br><span class="line">    img -= <span class="hljs-number">127.5</span></span><br><span class="line">    img *= <span class="hljs-number">0.007843</span></span><br><span class="line">    img = img[np.newaxis, :]</span><br><span class="line">    <span class="hljs-keyword">return</span> origin, img, resized_img</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">infer</span><span class="hljs-params">(image_path)</span>:</span></span><br><span class="line">    <span class="hljs-string">"""</span></span><br><span class="line"><span class="hljs-string">    预测，将结果保存到一副新的图片中</span></span><br><span class="line"><span class="hljs-string">    :param image_path:</span></span><br><span class="line"><span class="hljs-string">    :return:</span></span><br><span class="line"><span class="hljs-string">    """</span></span><br><span class="line">    origin, tensor_img, resized_img = read_image(image_path)</span><br><span class="line">    input_w, input_h = origin.size[<span class="hljs-number">0</span>], origin.size[<span class="hljs-number">1</span>]</span><br><span class="line">    image_shape = np.array([input_h, input_w], dtype=<span class="hljs-string">'int32'</span>)</span><br><span class="line">    <span class="hljs-comment"># print("image shape high:&#123;0&#125;, width:&#123;1&#125;".format(input_h, input_w))</span></span><br><span class="line">    t1 = time.time()</span><br><span class="line">    batch_outputs = exe.run(inference_program,</span><br><span class="line">                            feed=&#123;feed_target_names[<span class="hljs-number">0</span>]: tensor_img,</span><br><span class="line">                                  feed_target_names[<span class="hljs-number">1</span>]: image_shape[np.newaxis, :]&#125;,</span><br><span class="line">                            fetch_list=fetch_targets,</span><br><span class="line">                            return_numpy=<span class="hljs-literal">False</span>)</span><br><span class="line">    period = time.time() - t1</span><br><span class="line">    print(<span class="hljs-string">"predict cost time:&#123;0&#125;"</span>.format(<span class="hljs-string">"%2.2f sec"</span> % period))</span><br><span class="line">    bboxes = np.array(batch_outputs[<span class="hljs-number">0</span>])</span><br><span class="line">    <span class="hljs-comment"># print(bboxes)</span></span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">if</span> bboxes.shape[<span class="hljs-number">1</span>] != <span class="hljs-number">6</span>:</span><br><span class="line">        print(<span class="hljs-string">"No object found in &#123;&#125;"</span>.format(image_path))</span><br><span class="line">        <span class="hljs-keyword">return</span></span><br><span class="line">    labels = bboxes[:, <span class="hljs-number">0</span>].astype(<span class="hljs-string">'int32'</span>)</span><br><span class="line">    scores = bboxes[:, <span class="hljs-number">1</span>].astype(<span class="hljs-string">'float32'</span>)</span><br><span class="line">    boxes = bboxes[:, <span class="hljs-number">2</span>:].astype(<span class="hljs-string">'float32'</span>)</span><br><span class="line"></span><br><span class="line">    last_dot_index = image_path.rfind(<span class="hljs-string">'.'</span>)</span><br><span class="line">    out_path = image_path[:last_dot_index]</span><br><span class="line">    out_path += <span class="hljs-string">'-result.jpg'</span></span><br><span class="line">    draw_bbox_image(origin, boxes, labels, out_path)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:</span><br><span class="line">    image_name = sys.argv[<span class="hljs-number">1</span>]</span><br><span class="line">    image_path = image_name</span><br><span class="line">    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">10</span>):</span><br><span class="line">        image_path = <span class="hljs-string">"data/data6045/lslm-test/"</span>+str(i+<span class="hljs-number">1</span>)+<span class="hljs-string">".jpg"</span></span><br><span class="line">        infer(image_path)</span><br></pre></td></tr></table></figure>

<p><img src="/images/2019/11/18/cc0d9a30-0a01-11ea-b8d5-416bf8aed005.png" alt="image.png"></p>
<p><img src="/images/2019/11/18/f99b6fe0-0a01-11ea-b8d5-416bf8aed005.png" alt="image.png"></p>
<figure class="highlight shell hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -cf yolo-model.tar freeze-model/*</span><br></pre></td></tr></table></figure>

<p><a href="https://aistudio.baidu.com/aistudio/projectdetail/51588" target="_blank" rel="noopener">传送门</a></p>

        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-image">
        <a href="/2019/11/15/PaddlePaddle/" class="image is-7by1">
            <img class="thumbnail" src="/images/2019/11/15/4f36ef60-07a5-11ea-9869-b1d580c824bf.png" alt="PaddlePaddle Models">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-11-15T12:42:23.000Z">2019-11-15</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/人工智能/">人工智能</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    1 小时 读完 (大约 8106 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/11/15/PaddlePaddle/">PaddlePaddle Models</a>
            
        </h1>
        <div class="content">
            <h1 id="PaddlePaddle-Models"><a href="#PaddlePaddle-Models" class="headerlink" title="PaddlePaddle Models"></a>PaddlePaddle Models</h1><p><a href="https://github.com/PaddlePaddle/models" target="_blank" rel="noopener"><img src="https://img.shields.io/badge/docs-latest-brightgreen.svg?style=flat" alt="Documentation Status"></a> <a href="LICENSE"><img src="https://img.shields.io/badge/license-Apache%202-blue.svg" alt="License"></a></p>
<p>PaddlePaddle 提供了丰富的计算单元，使得用户可以采用模块化的方法解决各种学习问题。在此Repo中，我们展示了如何用 PaddlePaddle来解决常见的机器学习任务，提供若干种不同的易学易用的神经网络模型。PaddlePaddle用户可领取<strong>免费Tesla V100在线算力资源</strong>，高效训练模型，<strong>每日登陆即送12小时</strong>，<strong>连续五天运行再加送48小时</strong>，<a href="http://ai.baidu.com/support/news?action=detail&id=981" target="_blank" rel="noopener">前往使用免费算力</a>。</p>
        </div>
        
        
        <div class="level is-mobile">
            <div class="level-start">
                <div class="level-item">
                <a class="button is-size-7 is-light" href="/2019/11/15/PaddlePaddle/#more">阅读更多</a>
                </div>
            </div>
        </div>
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-image">
        <a href="/2019/11/11/graph-convolution/" class="image is-7by1">
            <img class="thumbnail" src="/images/2019/11/11/5cf319f0-0497-11ea-80dc-3ba86d67aae3.png" alt="graph-convolution">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-11-11T15:22:46.000Z">2019-11-11</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/文章/">文章</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    15 分钟 读完 (大约 2292 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/11/11/graph-convolution/">graph-convolution</a>
            
        </h1>
        <div class="content">
            <h1 id="图系列-从图-Graph-到图卷积-Graph-Convolution-漫谈图神经网络模型"><a href="#图系列-从图-Graph-到图卷积-Graph-Convolution-漫谈图神经网络模型" class="headerlink" title="图系列|从图(Graph)到图卷积(Graph Convolution): 漫谈图神经网络模型"></a>图系列|从图(Graph)到图卷积(Graph Convolution): 漫谈图神经网络模型</h1><p>笔者最近看了一些图与图卷积神经网络的论文，深感其强大，但一些Survey或教程默认了读者对图神经网络背景知识的了解，对未学过信号处理的读者不太友好。同时，很多教程只讲是什么，不讲为什么，也没有梳理清楚不同网络结构的区别与设计初衷(Motivation)。</p>
<p>因此，本文试图沿着图神经网络的历史脉络，从最早基于不动点理论的图神经网络(Graph Neural Network， GNN)一步步讲到当前用得最火的图卷积神经网络(Graph Convolutional Neural Network， GCN)， 期望通过本文带给读者一些灵感与启示。</p>
        </div>
        
        
        <div class="level is-mobile">
            <div class="level-start">
                <div class="level-item">
                <a class="button is-size-7 is-light" href="/2019/11/11/graph-convolution/#more">阅读更多</a>
                </div>
            </div>
        </div>
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-image">
        <a href="/2019/10/30/tabnine/" class="image is-7by1">
            <img class="thumbnail" src="/images/jdenticon/0324c5ccc3a32ce2e93b3c4381465d98c7daadd18368ce5a831d1b6c7227dd20.png" alt="tabnine">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-10-30T14:06:40.000Z">2019-10-30</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/文章/">文章</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    6 分钟 读完 (大约 943 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/10/30/tabnine/">tabnine</a>
            
        </h1>
        <div class="content">
            <h1 id="TabNine"><a href="#TabNine" class="headerlink" title="TabNine"></a>TabNine</h1><p>This is the repository for the backend of <a href="https://tabnine.com" target="_blank" rel="noopener">TabNine</a>, the all-language autocompleter.<br>There are no source files here because the backend is closed source.</p>
<p>You can make feature requests by filing an issue. You are also welcome to make pull requests for changes to the configuration files.</p>
<p><code>languages.yml</code> determines which file extensions are considered part of the same language. (For example, identifiers from <code>.c</code> files will be suggested in <code>.h</code> files.)</p>
<p><code>language_tokenization.json</code> determines how languages are tokenized. For example, identifiers can contain dashes in Lisp, but not in Java.</p>
<p>If your feature request is specific to a particular editor’s TabNine client, please file an issue in one of these repositories:</p>
<ul>
<li><a href="https://github.com/zxqfl/tabnine-vscode" target="_blank" rel="noopener">VS Code</a></li>
<li><a href="https://github.com/zxqfl/tabnine-sublime" target="_blank" rel="noopener">Sublime Text</a></li>
<li><a href="https://github.com/zxqfl/tabnine-vim" target="_blank" rel="noopener">Vim</a></li>
<li><a href="https://github.com/zxqfl/tabnine-atom" target="_blank" rel="noopener">Atom</a></li>
</ul>
<p>You may be interested in these TabNine clients written by third parties:</p>
<ul>
<li><a href="https://github.com/TommyX12/company-tabnine" target="_blank" rel="noopener">Emacs</a></li>
<li><a href="https://github.com/tbodt/deoplete-tabnine" target="_blank" rel="noopener">Vim (Deoplete)</a></li>
</ul>
<h1 id="Changelogs"><a href="#Changelogs" class="headerlink" title="Changelogs"></a>Changelogs</h1><p>If new features don’t work for you, check that you have the most recent version by typing <code>TabNine::version</code> into your text editor. If you don’t have the most recent version, try restarting your editor.</p>
<h2 id="2-0-11-August-24-2019"><a href="#2-0-11-August-24-2019" class="headerlink" title="2.0.11 (August 24, 2019)"></a>2.0.11 (August 24, 2019)</h2><ul>
<li><a href="https://tabnine.com/blog/local" target="_blank" rel="noopener">TabNine Local</a> is now enabled by default</li>
</ul>
<h2 id="2-0-0-—-2-0-10-July-15-—-August-20-2019"><a href="#2-0-0-—-2-0-10-July-15-—-August-20-2019" class="headerlink" title="2.0.0 — 2.0.10 (July 15 — August 20, 2019)"></a>2.0.0 — 2.0.10 (July 15 — August 20, 2019)</h2><ul>
<li><a href="https://tabnine.com/blog/deep" target="_blank" rel="noopener">Deep TabNine</a><ul>
<li>Can download and run <a href="https://tabnine.com/blog/local" target="_blank" rel="noopener">TabNine Local</a> models</li>
<li>Can connect to <a href="https://tabnine.com/subscribe#cloud" target="_blank" rel="noopener">TabNine Cloud</a></li>
</ul>
</li>
<li>Simplified bracket pairing logic</li>
<li>Simplified filesystem event handling</li>
<li>Added a configuration panel for viewing settings and logs which can be accessed by typing <code>TabNine::config</code></li>
</ul>
<h2 id="1-0-14-May-16-2019"><a href="#1-0-14-May-16-2019" class="headerlink" title="1.0.14 (May 16, 2019)"></a>1.0.14 (May 16, 2019)</h2><ul>
<li>TabNine no longer watches for filesystem events in ignored directories (closes <a href="https://github.com/zxqfl/TabNine/issues/43" target="_blank" rel="noopener">#43</a>).</li>
<li>TabNine now waits until a completion is requested to start the language server (closes <a href="https://github.com/zxqfl/TabNine/issues/50" target="_blank" rel="noopener">#50</a>).</li>
<li>Files with the <code>.d</code> extension are now recognized as D source files (closes <a href="https://github.com/zxqfl/TabNine/issues/56" target="_blank" rel="noopener">#56</a>).</li>
<li>Added LSP default configuration for PureScript.</li>
<li>Fixed a logic error that caused index size to be tracked incorrectly in some cases.</li>
</ul>
<h2 id="1-0-10-December-1-2018"><a href="#1-0-10-December-1-2018" class="headerlink" title="1.0.10 (December 1, 2018)"></a>1.0.10 (December 1, 2018)</h2><ul>
<li>Fixed an internal logic error which could put indexing threads into a bad state, leading to an infinite loop (might close <a href="https://github.com/zxqfl/TabNine/issues/24" target="_blank" rel="noopener">#24</a>, we’ll see).</li>
<li>TabNine now considers a wider range of possibilities when completing in a zero-char context (i.e. when there are no characters immediately before the cursor).</li>
<li>TabNine now includes <code>-</code> in identifiers when parsing Racket code.</li>
</ul>
<h2 id="1-0-9-November-27-2018"><a href="#1-0-9-November-27-2018" class="headerlink" title="1.0.9 (November 27, 2018)"></a>1.0.9 (November 27, 2018)</h2><ul>
<li>TabNine now uses the context after the cursor to filter its suggestions. For example, if there are tokens on the same line as the cursor, TabNine will not make a suggestion ending in a semicolon (unless there are already instances in the codebase of semicolons occurring in the middle of a line).</li>
<li>TabNine removes tokens matching the regex <code>\d.*[a-zA-Z].*\d.*[a-zA-Z]</code> from the project index. This is supposed to prevent long keys or base64 literals from occurring in autocompletion suggestions. The tokens are <strong>not</strong> filtered from the directory index or the file index.</li>
<li>TabNine now recognizes <code>.tsx</code> files as TypeScript rather than <code>.xml</code> (closes <a href="https://github.com/zxqfl/TabNine/issues/21" target="_blank" rel="noopener">#21</a>).</li>
<li>TabNine only checks its version directory, not its target directory, when auto-updating or writing registration keys. (This fixes an issue associated with DOS path shortening.)</li>
</ul>
<h2 id="1-0-7-November-20-2018"><a href="#1-0-7-November-20-2018" class="headerlink" title="1.0.7 (November 20, 2018)"></a>1.0.7 (November 20, 2018)</h2><ul>
<li>Semantic completion is added! This allows TabNine to integrate with any language server that implements the <a href="https://microsoft.github.io/language-server-protocol/" target="_blank" rel="noopener">Language Server Protocol</a>.<ul>
<li>TabNine will integrate the language server’s suggestions with its own. For example, TabNine can suggest multi-token completions where the first token is provided by the language server.</li>
<li>TabNine queries the language server asynchronously. So, if the language server is slow, you will see TabNine’s results only. Continue typing to see the language server’s results.</li>
<li>TabNine passes along any type information or documentation provided by the language server. (The Sublime and VS Code clients are not yet updated to display the documentation; this is coming soon.)</li>
<li>See the <a href="https://tabnine.com/semantic" target="_blank" rel="noopener">semantic completion guide</a> for configuration help.</li>
</ul>
</li>
<li>Paid index size limit increased to 100 MB (from 15 MB).</li>
<li>Free index size limit increased to 400 KB (from 200 KB).</li>
<li>Improved indexing performance.</li>
<li>Increased license price to $49/$99 personal/business (from $29/$89).</li>
<li>TabNine now provides closing brackets for its suggestions (so if it suggests <code>foo(</code> it will additionally insert <code>)</code> to the right of the cursor once the suggestion is accepted). The editor clients do not support this yet as it requires an upgrade to the communication protocol with TabNine; this is coming soon. Closes <a href="https://github.com/zxqfl/TabNine/issues/11" target="_blank" rel="noopener">#11</a> as this is no longer an issue with the TabNine backend.</li>
<li>TabNine now searches all parents to find the project root rather than stopping at the first <code>.git</code>. This permits nested Git repositories (closes <a href="https://github.com/zxqfl/TabNine/issues/5" target="_blank" rel="noopener">#5</a>).</li>
<li>TabNine provides an API call to get the regex it uses to find identifiers (closes <a href="https://github.com/zxqfl/TabNine/issues/7" target="_blank" rel="noopener">#7</a>).</li>
<li>TabNine no longer indexes files in <code>.git</code> (closes <a href="https://github.com/zxqfl/TabNine/issues/8" target="_blank" rel="noopener">#8</a>).</li>
<li>TabNine now respects <code>.tabnineignore</code> files (closes <a href="https://github.com/zxqfl/TabNine/issues/15" target="_blank" rel="noopener">#15</a>).</li>
<li>TabNine allows disabling auto-update by typing <code>TabNine::disable_auto_update</code> into your text editor (closes <a href="https://github.com/zxqfl/TabNine/issues/14" target="_blank" rel="noopener">#14</a>).</li>
<li>TabNine no longer stores registration keys and config in same directory where it is installed. This should prevent registration keys and config from being overwritten by client updates (closes <a href="https://github.com/zxqfl/TabNine/issues/10" target="_blank" rel="noopener">#10</a>). You can type <code>TabNine::config_dir</code> to see where config files are being stored.</li>
</ul>

        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-image">
        <a href="/2019/09/27/Desition-Tree/" class="image is-7by1">
            <img class="thumbnail" src="/images/jdenticon/0324c5ccc3a32ce2e93b3c4381465d98c7daadd18368ce5a831d1b6c7227dd20.png" alt="Desition Tree">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-09-27T06:52:07.000Z">2019-09-27</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/人工智能/">人工智能</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    23 分钟 读完 (大约 3425 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/09/27/Desition-Tree/">Desition Tree</a>
            
        </h1>
        <div class="content">
            <h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><ul>
<li><a href="https://github.com/NLP-LOVE/ML-NLP/tree/master/Machine%20Learning/3.Desition%20Tree#1-什么是决策树" target="_blank" rel="noopener">1. 什么是决策树</a><ul>
<li><a href="https://github.com/NLP-LOVE/ML-NLP/tree/master/Machine%20Learning/3.Desition%20Tree#11-决策树的基本思想" target="_blank" rel="noopener">1.1 决策树的基本思想</a></li>
<li><a href="https://github.com/NLP-LOVE/ML-NLP/tree/master/Machine%20Learning/3.Desition%20Tree#12-树的成长过程" target="_blank" rel="noopener">1.2 “树”的成长过程</a></li>
<li><a href="https://github.com/NLP-LOVE/ML-NLP/tree/master/Machine%20Learning/3.Desition%20Tree#13-树怎么长" target="_blank" rel="noopener">1.3 “树”怎么长</a></li>
<li><a href="https://github.com/NLP-LOVE/ML-NLP/tree/master/Machine%20Learning/3.Desition%20Tree#131-id3算法" target="_blank" rel="noopener">1.3.1 ID3算法</a></li>
<li><a href="https://github.com/NLP-LOVE/ML-NLP/tree/master/Machine%20Learning/3.Desition%20Tree#132-c45" target="_blank" rel="noopener">1.3.2 C4.5</a></li>
<li><a href="https://github.com/NLP-LOVE/ML-NLP/tree/master/Machine%20Learning/3.Desition%20Tree#133-cart算法" target="_blank" rel="noopener">1.3.3 CART算法</a></li>
<li><a href="https://github.com/NLP-LOVE/ML-NLP/tree/master/Machine%20Learning/3.Desition%20Tree#134-三种不同的决策树" target="_blank" rel="noopener">1.3.4 三种不同的决策树</a></li>
</ul>
</li>
<li><a href="https://github.com/NLP-LOVE/ML-NLP/tree/master/Machine%20Learning/3.Desition%20Tree#2-树形结构为什么不需要归一化" target="_blank" rel="noopener">2. 树形结构为什么不需要归一化?</a></li>
<li><a href="https://github.com/NLP-LOVE/ML-NLP/tree/master/Machine%20Learning/3.Desition%20Tree#3-分类决策树和回归决策树的区别" target="_blank" rel="noopener">3. 分类决策树和回归决策树的区别</a></li>
<li><a href="https://github.com/NLP-LOVE/ML-NLP/tree/master/Machine%20Learning/3.Desition%20Tree#4-决策树如何剪枝" target="_blank" rel="noopener">4. 决策树如何剪枝</a></li>
<li><a href="https://github.com/NLP-LOVE/ML-NLP/blob/master/Machine%20Learning/3.Desition%20Tree/DecisionTree.ipynb" target="_blank" rel="noopener">5. 代码实现</a></li>
</ul>
<h2 id="1-什么是决策树"><a href="#1-什么是决策树" class="headerlink" title="1. 什么是决策树"></a>1. 什么是决策树</h2><h3 id="1-1-决策树的基本思想"><a href="#1-1-决策树的基本思想" class="headerlink" title="1.1 决策树的基本思想"></a>1.1 决策树的基本思想</h3><p>其实用一下图片能更好的理解LR模型和决策树模型算法的根本区别，我们可以思考一下一个决策问题：是否去相亲，一个女孩的母亲要给这个女海介绍对象。</p>
<p><img src="https://wx2.sinaimg.cn/large/00630Defly1g4q286viibj30pk0pfk09.jpg" alt="image"></p>
<p>大家都看得很明白了吧！LR模型是一股脑儿的把所有特征塞入学习，而决策树更像是编程语言中的if-else一样，去做条件判断，这就是根本性的区别。</p>
<h3 id="1-2-“树”的成长过程"><a href="#1-2-“树”的成长过程" class="headerlink" title="1.2 “树”的成长过程"></a>1.2 “树”的成长过程</h3><p>决策树基于“树”结构进行决策的，这时我们就要面临两个问题 ：</p>
<ul>
<li>“树”怎么长。</li>
<li>这颗“树”长到什么时候停。</li>
</ul>
<p>弄懂了这两个问题，那么这个模型就已经建立起来了，决策树的总体流程是“分而治之”的思想，一是自根至叶的递归过程，一是在每个中间节点寻找一个“划分”属性，相当于就是一个特征属性了。接下来我们来逐个解决以上两个问题。</p>
<h4 id="这颗“树”长到什么时候停"><a href="#这颗“树”长到什么时候停" class="headerlink" title="这颗“树”长到什么时候停"></a>这颗“树”长到什么时候停</h4><ul>
<li>当前结点包含的样本全属于同一类别，无需划分；例如：样本当中都是决定去相亲的，属于同一类别，就是不管特征如何改变都不会影响结果，这种就不需要划分了。</li>
<li>当前属性集为空，或是所有样本在所有属性上取值相同，无法划分；例如：所有的样本特征都是一样的，就造成无法划分了，训练集太单一。</li>
<li>当前结点包含的样本集合为空，不能划分。</li>
</ul>
<h3 id="1-3-“树”怎么长"><a href="#1-3-“树”怎么长" class="headerlink" title="1.3 “树”怎么长"></a>1.3 “树”怎么长</h3><p>在生活当中，我们都会碰到很多需要做出决策的地方，例如：吃饭地点、数码产品购买、旅游地区等，你会发现在这些选择当中都是依赖于大部分人做出的选择，也就是跟随大众的选择。其实在决策树当中也是一样的，当大部分的样本都是同一类的时候，那么就已经做出了决策。</p>
<p>我们可以把大众的选择抽象化，这就引入了一个概念就是纯度，想想也是如此，大众选择就意味着纯度越高。好，在深入一点，就涉及到一句话：<strong>信息熵越低，纯度越高</strong>。我相信大家或多或少都听说过“熵”这个概念，信息熵通俗来说就是用来度量包含的“信息量”，如果样本的属性都是一样的，就会让人觉得这包含的信息很单一，没有差异化，相反样本的属性都不一样，那么包含的信息量就很多了。</p>
<p>一到这里就头疼了，因为马上要引入信息熵的公式，其实也很简单：</p>
<p><img src="https://latex.codecogs.com/gif.latex?Ent(D)=-%5Csum_%7Bk=1%7D%5E%7B%7Cy%7C%7Dp_klog_2p_k" alt></p>
<p>Pk表示的是：当前样本集合D中第k类样本所占的比例为Pk。</p>
<p><strong>信息增益</strong></p>
<p>废话不多说直接上公式：</p>
<p><img src="https://wx3.sinaimg.cn/large/00630Defly1g4q5h6oby7j30he08tdh5.jpg" alt="image"></p>
<p>看不懂的先不管，简单一句话就是：划分前的信息熵–划分后的信息熵。表示的是向纯度方向迈出的“步长”。</p>
<p>好了，有了前面的知识，我们就可以开始“树”的生长了。</p>
<h4 id="1-3-1-ID3算法"><a href="#1-3-1-ID3算法" class="headerlink" title="1.3.1 ID3算法"></a>1.3.1 ID3算法</h4><p>解释：在根节点处计算信息熵，然后根据属性依次划分并计算其节点的信息熵，用根节点信息熵–属性节点的信息熵=信息增益，根据信息增益进行降序排列，排在前面的就是第一个划分属性，其后依次类推，这就得到了决策树的形状，也就是怎么“长”了。</p>
<p>如果不理解的，可以查看我分享的图片示例，结合我说的，包你看懂：</p>
<ol>
<li><a href="https://www.wailian.work/images/2018/12/11/image39e7b.png" target="_blank" rel="noopener">第一张图.jpg</a></li>
<li><a href="https://www.wailian.work/images/2018/12/11/image61cdc.png" target="_blank" rel="noopener">第二张图.jpg</a></li>
<li><a href="https://www.wailian.work/images/2018/12/11/image9e194.png" target="_blank" rel="noopener">第三张图.jpg</a></li>
<li><a href="https://www.wailian.work/images/2018/12/11/image09288.png" target="_blank" rel="noopener">第四张图.jpg</a></li>
</ol>
<p>不过，信息增益有一个问题：对可取值数目较多的属性有所偏好，例如：考虑将“编号”作为一个属性。为了解决这个问题，引出了另一个 算法C4.5。</p>
<h4 id="1-3-2-C4-5"><a href="#1-3-2-C4-5" class="headerlink" title="1.3.2 C4.5"></a>1.3.2 C4.5</h4><p>为了解决信息增益的问题，引入一个信息增益率：</p>
<p><img src="https://latex.codecogs.com/gif.latex?Gain_ratio(D,a)=%5Cfrac%7BGain(D,a)%7D%7BIV(a)%7D" alt></p>
<p>其中：</p>
<p><img src="https://latex.codecogs.com/gif.latex?IV(a)=-%5Csum_%7Bv=1%7D%5E%7BV%7D%5Cfrac%7B%7CD%5Ev%7C%7D%7B%7CD%7C%7Dlog_2%5Cfrac%7B%7CD%5Ev%7C%7D%7B%7CD%7C%7D" alt></p>
<p>属性a的可能取值数目越多(即V越大)，则IV(a)的值通常就越大。<strong>信息增益比本质： 是在信息增益的基础之上乘上一个惩罚参数。特征个数较多时，惩罚参数较小；特征个数较少时，惩罚参数较大。</strong>不过有一个缺点：</p>
<ul>
<li>缺点：信息增益率偏向取值较少的特征。</li>
</ul>
<p>使用信息增益率：基于以上缺点，并不是直接选择信息增益率最大的特征，而是现在候选特征中找出信息增益高于平均水平的特征，然后在这些特征中再选择信息增益率最高的特征。</p>
<h4 id="1-3-3-CART算法"><a href="#1-3-3-CART算法" class="headerlink" title="1.3.3 CART算法"></a>1.3.3 CART算法</h4><p>数学家真实聪明，想到了另外一个表示纯度的方法，叫做基尼指数(讨厌的公式)：</p>
<p><img src="https://wx1.sinaimg.cn/large/00630Defly1g4q5dmvyykj30eb01edfs.jpg" alt="image"></p>
<p>表示在样本集合中一个随机选中的样本被分错的概率。举例来说，现在一个袋子里有3种颜色的球若干个，伸手进去掏出2个球，颜色不一样的概率，这下明白了吧。<strong>Gini(D)越小，数据集D的纯度越高。</strong></p>
<h5 id="举个例子"><a href="#举个例子" class="headerlink" title="举个例子"></a>举个例子</h5><p>假设现在有特征 “学历”，此特征有三个特征取值： “本科”，“硕士”， “博士”，</p>
<p>当使用“学历”这个特征对样本集合D进行划分时，划分值分别有三个，因而有三种划分的可能集合，划分后的子集如下：</p>
<p>1.划分点： “本科”，划分后的子集合 ： {本科}，{硕士，博士}</p>
<p>2.划分点： “硕士”，划分后的子集合 ： {硕士}，{本科，博士}</p>
<p>3.划分点： “硕士”，划分后的子集合 ： {博士}，{本科，硕士}}</p>
<p>对于上述的每一种划分，都可以计算出基于 <strong>划分特征= 某个特征值</strong> 将样本集合D划分为两个子集的纯度：</p>
<p><img src="https://latex.codecogs.com/gif.latex?Gini(D,A)=%5Cfrac%7B%7CD_1%7C%7D%7B%7CD%7C%7DGini(D_1)+%5Cfrac%7B%7CD_2%7C%7D%7B%7CD%7C%7DGini(D_2)" alt></p>
<p>因而<strong>对于一个具有多个取值（超过2个）的特征，需要计算以每一个取值作为划分点，对样本D划分之后子集的纯度Gini(D,Ai)，(其中Ai 表示特征A的可能取值)</strong></p>
<p>然后从所有的可能划分的Gini(D,Ai)中找出Gini指数最小的划分，这个划分的划分点，便是使用特征A对样本集合D进行划分的最佳划分点。到此就可以长成一棵“大树”了。</p>
<h4 id="1-3-4-三种不同的决策树"><a href="#1-3-4-三种不同的决策树" class="headerlink" title="1.3.4 三种不同的决策树"></a>1.3.4 三种不同的决策树</h4><ul>
<li><p><strong>ID3</strong>：取值多的属性，更容易使数据更纯，其信息增益更大。</p>
<p>训练得到的是一棵庞大且深度浅的树：不合理。</p>
</li>
<li><p><strong>C4.5</strong>：采用信息增益率替代信息增益。</p>
</li>
<li><p><strong>CART</strong>：以基尼系数替代熵，最小化不纯度，而不是最大化信息增益。</p>
</li>
</ul>
<h2 id="2-树形结构为什么不需要归一化"><a href="#2-树形结构为什么不需要归一化" class="headerlink" title="2. 树形结构为什么不需要归一化?"></a>2. 树形结构为什么不需要归一化?</h2><p>因为数值缩放不影响分裂点位置，对树模型的结构不造成影响。<br>按照特征值进行排序的，排序的顺序不变，那么所属的分支以及分裂点就不会有不同。而且，树模型是不能进行梯度下降的，因为构建树模型（回归树）寻找最优点时是通过寻找最优分裂点完成的，因此树模型是阶跃的，阶跃点是不可导的，并且求导没意义，也就不需要归一化。</p>
<p>既然树形结构（如决策树、RF）不需要归一化，那为何非树形结构比如Adaboost、SVM、LR、Knn、KMeans之类则需要归一化。</p>
<p>对于线性模型，特征值差别很大时，运用梯度下降的时候，损失等高线是椭圆形，需要进行多次迭代才能到达最优点。<br>但是如果进行了归一化，那么等高线就是圆形的，促使SGD往原点迭代，从而导致需要的迭代次数较少。</p>
<h2 id="3-分类决策树和回归决策树的区别"><a href="#3-分类决策树和回归决策树的区别" class="headerlink" title="3. 分类决策树和回归决策树的区别"></a>3. 分类决策树和回归决策树的区别</h2><p>Classification And Regression Tree(CART)是决策树的一种，CART算法既可以用于创建分类树（Classification Tree），也可以用于创建回归树（Regression Tree），两者在建树的过程稍有差异。</p>
<p><strong>回归树</strong>：</p>
<p>CART回归树是假设树为二叉树，通过不断将特征进行分裂。比如当前树结点是基于第j个特征值进行分裂的，设该特征值小于s的样本划分为左子树，大于s的样本划分为右子树。 </p>
<p><img src="https://julyedu-img.oss-cn-beijing.aliyuncs.com/quesbase6415343854853617715.png" alt></p>
<p>而CART回归树实质上就是在该特征维度对样本空间进行划分，而这种空间划分的优化是一种NP难问题，因此，在决策树模型中是使用启发式方法解决。典型CART回归树产生的目标函数为：</p>
<p><img src="https://julyedu-img.oss-cn-beijing.aliyuncs.com/quesbase64153438551488112806.png" alt></p>
<p>因此，当我们为了求解最优的切分特征j和最优的切分点s，就转化为求解这么一个目标函数：</p>
<p><img src="https://julyedu-img.oss-cn-beijing.aliyuncs.com/quesbase6415343855213970444.png" alt></p>
<p>所以我们只要遍历所有特征的的所有切分点，就能找到最优的切分特征和切分点。最终得到一棵回归树。</p>
<p>参考文章：<a href="https://blog.csdn.net/jiede1/article/details/76034328" target="_blank" rel="noopener">经典算法详解–CART分类决策树、回归树和模型树</a></p>
<h2 id="4-决策树如何剪枝"><a href="#4-决策树如何剪枝" class="headerlink" title="4. 决策树如何剪枝"></a>4. 决策树如何剪枝</h2><p>决策树的剪枝基本策略有 预剪枝 (Pre-Pruning) 和 后剪枝 (Post-Pruning)。</p>
<ul>
<li><strong>预剪枝</strong>：其中的核心思想就是，在每一次实际对结点进行进一步划分之前，先采用验证集的数据来验证如果划分是否能提高划分的准确性。如果不能，就把结点标记为叶结点并退出进一步划分；如果可以就继续递归生成节点。</li>
<li><strong>后剪枝</strong>：后剪枝则是先从训练集生成一颗完整的决策树，然后自底向上地对非叶结点进行考察，若将该结点对应的子树替换为叶结点能带来泛化性能提升，则将该子树替换为叶结点。</li>
</ul>
<p>参考文章：<a href="https://blog.csdn.net/am290333566/article/details/81187562" target="_blank" rel="noopener">决策树及决策树生成与剪枝</a></p>
<h2 id="5-代码实现"><a href="#5-代码实现" class="headerlink" title="5. 代码实现"></a>5. 代码实现</h2><p>GitHub：<a href="https://github.com/NLP-LOVE/ML-NLP/blob/master/Machine%20Learning/3.Desition%20Tree/DecisionTree.ipynb" target="_blank" rel="noopener">https://github.com/NLP-LOVE/ML-NLP/blob/master/Machine%20Learning/3.Desition%20Tree/DecisionTree.ipynb</a></p>
<hr>
<blockquote>
<p>作者：<a href="https://github.com/NLP-LOVE/ML-NLP" target="_blank" rel="noopener">@mantchs</a></p>
<p>GitHub：<a href="https://github.com/NLP-LOVE/ML-NLP" target="_blank" rel="noopener">https://github.com/NLP-LOVE/ML-NLP</a></p>
<p>欢迎大家加入讨论！共同完善此项目！群号：【541954936】<a target="_blank" href="//shang.qq.com/wpa/qunwpa?idkey=863f915b9178560bd32ca07cd090a7d9e6f5f90fcff5667489697b1621cecdb3"><img border="0" src="http://pub.idqqimg.com/wpa/images/group.png" alt="NLP面试学习群" title="NLP面试学习群"></a></p>
</blockquote>

        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-image">
        <a href="/2019/09/16/2019年度机器学习49个顶级工程汇总/" class="image is-7by1">
            <img class="thumbnail" src="/images/jdenticon/0324c5ccc3a32ce2e93b3c4381465d98c7daadd18368ce5a831d1b6c7227dd20.png" alt="2019年度机器学习49个顶级工程汇总">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-09-16T01:56:47.000Z">2019-09-16</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/人工智能/">人工智能</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    16 分钟 读完 (大约 2440 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/09/16/2019年度机器学习49个顶级工程汇总/">2019年度机器学习49个顶级工程汇总</a>
            
        </h1>
        <div class="content">
            <h1 id="2019年度机器学习49个顶级工程汇总"><a href="#2019年度机器学习49个顶级工程汇总" class="headerlink" title="2019年度机器学习49个顶级工程汇总"></a>2019年度机器学习49个顶级工程汇总</h1><blockquote>
<p>过去一年中，我们比较了近22000个机器学习开源工程，并筛选了49个顶级项目（筛选率0.22%）。</p>
</blockquote>
<p>其中包括以下6个分类</p>
<ul>
<li>计算机视觉（1~5）</li>
<li>强化学习（6~13）</li>
<li>NLP（14~20）</li>
<li>GAN（21~26）</li>
<li>Neural Network（27~35）</li>
<li>Toolkit（36~49）</li>
</ul>
<blockquote>
<p>我们花了很大的精力筛选这个list，并小心的选择出2018年1月到12月间最好的工程。为了保证名单质量，Mybridge AI协同考虑了流行度、参与度、发布时间等多重因素。</p>
</blockquote>
<p>计算机视觉<br>1、Detectron：facebook发布的目标检测工具【18913 star on Github】<br>项目地址：<br><a href="https://github.com/facebookresearch/Detectron?utm_source=mybridge&utm_medium=blog&utm_campaign=read_more" target="_blank" rel="noopener">https://github.com/facebookresearch/Detectron?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more</a></p>
<p><img src="/images/2019/09/16/34d7fab0-d825-11e9-a737-93ed7eeda0fa.png" alt="image.png"></p>
<p>2、Openpost：多人实时特征点检测工具【11052 stars on GitHub】<br>项目地址：<br><a href="https://github.com/CMU-Perceptual-Computing-Lab/openpose?utm_source=mybridge&utm_medium=blog&utm_campaign=read_more" target="_blank" rel="noopener">https://github.com/CMU-Perceptual-Computing-Lab/openpose?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more</a></p>
<p><img src="/images/2019/09/16/490fc2b0-d825-11e9-a737-93ed7eeda0fa.png" alt="image.png"></p>
<p>3、DensePost：2维人体图片转3维的实时映射方法。【4165 stars on Github】<br>项目地址：<br><a href="https://github.com/facebookresearch/Densepose?utm_source=mybridge&utm_medium=blog&utm_campaign=read_more" target="_blank" rel="noopener">https://github.com/facebookresearch/Densepose?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more</a></p>
<p><img src="/images/2019/09/16/5596da50-d825-11e9-a737-93ed7eeda0fa.png" alt="image.png"></p>
<p>4、Maskrcnn-benchmark：（Pytorch）语义分割与目标检测工具包。【3888 stars on Github】<br>项目地址：<br><a href="https://github.com/facebookresearch/maskrcnn-benchmark?utm_source=mybridge&utm_medium=blog&utm_campaign=read_more" target="_blank" rel="noopener">https://github.com/facebookresearch/maskrcnn-benchmark?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more</a></p>
<p><img src="/images/2019/09/16/62cf8eb0-d825-11e9-a737-93ed7eeda0fa.png" alt="image.png"></p>
<p>5、SNIPER：多尺度目标检测算法。【1963 stars on Github】<br>项目地址：<br><a href="https://github.com/mahyarnajibi/SNIPER?utm_source=mybridge&utm_medium=blog&utm_campaign=read_more" target="_blank" rel="noopener">https://github.com/mahyarnajibi/SNIPER?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more</a></p>
<p><img src="/images/2019/09/16/728c2ed0-d825-11e9-a737-93ed7eeda0fa.png" alt="image.png"></p>
<p>强化学习<br>6、Psychlab：Psychlab实验范例。【5595 stars on Github】<br>项目地址：<br><a href="https://github.com/deepmind/lab/tree/master/game_scripts/levels/contributed/psychlab?utm_source=mybridge&utm_medium=blog&utm_campaign=read_more" target="_blank" rel="noopener">https://github.com/deepmind/lab/tree/master/game_scripts/levels/contributed/psychlab?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more</a></p>
<p><img src="/images/2019/09/16/7faf1140-d825-11e9-a737-93ed7eeda0fa.png" alt="image.png"></p>
<p>7、ELF：一个灵活、轻量、可扩展的游戏研究平台。【2406 stars on Github】<br>项目地址：<br><a href="https://github.com/pytorch/elf?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more" target="_blank" rel="noopener">https://github.com/pytorch/elf?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more</a></p>
<p>8、TRFL：（TensorFlow）强化学习agent工具包。【2312 stars on Github】<br>项目地址：<br><a href="https://github.com/deepmind/trfl?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more" target="_blank" rel="noopener">https://github.com/deepmind/trfl?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more</a></p>
<p>9、Horizon：首个用于大规模需求的开源强化学习平台。【1703 stars on Github】<br>项目地址：<br><a href="https://github.com/facebookresearch/Horizon?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more" target="_blank" rel="noopener">https://github.com/facebookresearch/Horizon?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more</a></p>
<p>10、Chess-alpha-zero：国际象棋强化学习项目（基于AlphaGo Zero方法）。【1307 stars on Github】<br>项目地址：<br><a href="https://github.com/Zeta36/chess-alpha-zero?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more" target="_blank" rel="noopener">https://github.com/Zeta36/chess-alpha-zero?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more</a></p>
<p>11、Dm_control：DeepMind工具包。【1231 stars on Github】<br>项目地址：<br><a href="https://github.com/deepmind/dm_control?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more" target="_blank" rel="noopener">https://github.com/deepmind/dm_control?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more</a></p>
<p>12、MAMEToolkit：基于强化学习的电子游戏python库。【437 stars on Github】<br>项目地址：<br><a href="https://github.com/M-J-Murray/MAMEToolkit?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more" target="_blank" rel="noopener">https://github.com/M-J-Murray/MAMEToolkit?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more</a></p>
<p>13、Reaver：模块化的深度强化学习框架（星际争霸2）。【355 stars on Github】<br>项目地址：<br><a href="https://github.com/inoryy/reaver?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more" target="_blank" rel="noopener">https://github.com/inoryy/reaver?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more</a></p>
<p>NLP<br>14、Bert：BERT的TensorFlow代码，以及预训练模型。【11703 stars on Github】<br>项目地址：<br><a href="https://github.com/google-research/bert?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more" target="_blank" rel="noopener">https://github.com/google-research/bert?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more</a></p>
<p>15、Pytext：基于Pytorch的神经语言模型框架。【4466 stars on Github】<br>项目地址：<br><a href="https://github.com/facebookresearch/pytext?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more" target="_blank" rel="noopener">https://github.com/facebookresearch/pytext?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more</a></p>
<p>16、Bert-as-service：BERT模型的网络服务版本<br>项目地址：<br><a href="https://github.com/hanxiao/bert-as-service?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more" target="_blank" rel="noopener">https://github.com/hanxiao/bert-as-service?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more</a></p>
<p>17、UnsupervisedMT：基于Phrase的无监督机器翻译方法。【1068 stars on Github】<br>项目地址：<br><a href="https://github.com/facebookresearch/UnsupervisedMT?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more" target="_blank" rel="noopener">https://github.com/facebookresearch/UnsupervisedMT?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more</a></p>
<p>18、DecaNLP：NLP十项全能工具，多任务模型。【1648 stars on Github】<br>项目地址：<br><a href="https://github.com/salesforce/decaNLP?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more" target="_blank" rel="noopener">https://github.com/salesforce/decaNLP?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more</a></p>
<p>19、NLP-architect：来自英特尔AI实验室的python工具包，包含了当前NLP领域的多种最佳模型。【1751 stars on Github】<br>项目地址：<br><a href="https://github.com/NervanaSystems/nlp-architect?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more" target="_blank" rel="noopener">https://github.com/NervanaSystems/nlp-architect?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more</a></p>
<p>20、Gluon-nlp：NLP工具包。【1263 stars on Github】<br>项目地址：<br><a href="https://github.com/dmlc/gluon-nlp?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more" target="_blank" rel="noopener">https://github.com/dmlc/gluon-nlp?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more</a></p>
<p>GAN<br>21、DeOldify：一个基于深度学习的图像补全工具包。【5060 stars on Github】<br>项目地址：<br><a href="https://github.com/jantic/DeOldify?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more" target="_blank" rel="noopener">https://github.com/jantic/DeOldify?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more</a></p>
<p>22、Progressive_growing_of_gans：GAN的变种实现，提高生产质量、稳定性以及多样性。<br>项目地址：<br><a href="https://github.com/tkarras/progressive_growing_of_gans?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more" target="_blank" rel="noopener">https://github.com/tkarras/progressive_growing_of_gans?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more</a></p>
<p>23、MUNIT：多模态无监督图像翻译。【1339 stars on Github】<br>项目地址：<br><a href="https://github.com/NVlabs/MUNIT?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more" target="_blank" rel="noopener">https://github.com/NVlabs/MUNIT?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more</a></p>
<p>24、Transparent_latent_gan：使用监督学习来解释GAN的隐空间信息。【1337 stars on Github】<br>项目地址：<br><a href="https://github.com/SummitKwan/transparent_latent_gan?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more" target="_blank" rel="noopener">https://github.com/SummitKwan/transparent_latent_gan?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more</a></p>
<p>25、Gandissect：基于Pytorch的可视化以及理解GAN的神经元信息。【1065 stars on Github】<br>项目地址：<br><a href="https://github.com/CSAILVision/gandissect?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more" target="_blank" rel="noopener">https://github.com/CSAILVision/gandissect?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more</a></p>
<p>26、GANimation：单张图片的表情变换。【869 stars on Github】<br>项目地址：<br><a href="https://github.com/albertpumarola/GANimation?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more" target="_blank" rel="noopener">https://github.com/albertpumarola/GANimation?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more</a><br>神经网络<br>27、Fastai：加速神经网络训练过程，并提高准确率。【11597 stars on Github】<br>项目地址：<br><a href="https://github.com/fastai/fastai?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more" target="_blank" rel="noopener">https://github.com/fastai/fastai?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more</a></p>
<p>28、DeepCreamPy：图像修复。【7046 stars on Github】<br>项目地址：<br><a href="https://github.com/deeppomf/DeepCreamPy?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more" target="_blank" rel="noopener">https://github.com/deeppomf/DeepCreamPy?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more</a></p>
<p>29、Augmentor v0.2、图像增强工具包。【2805 stars on Github】<br>项目地址：<br><a href="https://github.com/mdbloice/Augmentor?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more" target="_blank" rel="noopener">https://github.com/mdbloice/Augmentor?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more</a></p>
<p>30、Graph_nets：Tensorflow的图网络构建工具。【2723 stars on Github】<br>项目地址：<br><a href="https://github.com/deepmind/graph_nets?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more" target="_blank" rel="noopener">https://github.com/deepmind/graph_nets?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more</a></p>
<p>31、Textgenrnn：使用预训练字符级RNN生成文本。【1900 stars on Github】<br>项目地址：<br><a href="https://github.com/minimaxir/textgenrnn?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more" target="_blank" rel="noopener">https://github.com/minimaxir/textgenrnn?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more</a></p>
<p>32、Person-blocker：图像中自动删除人像。【1806 stars on Github】<br>项目地址：<br><a href="https://github.com/minimaxir/person-blocker?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more" target="_blank" rel="noopener">https://github.com/minimaxir/person-blocker?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more</a></p>
<p>33、Deepvariant：DNA序列数据的分析工具<br>项目地址：<br><a href="https://github.com/google/deepvariant?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more" target="_blank" rel="noopener">https://github.com/google/deepvariant?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more</a></p>
<p>34、Video-nolocal-net：non-local神经网络的视频分类方法。【1049 stars on Github】<br>项目地址：<br><a href="https://github.com/facebookresearch/video-nonlocal-net?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more" target="_blank" rel="noopener">https://github.com/facebookresearch/video-nonlocal-net?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more</a></p>
<p>35、Ann-visualizer：神经网络可视化工具。【922 stars on Github】<br>项目地址：<br><a href="https://github.com/Prodicode/ann-visualizer?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more" target="_blank" rel="noopener">https://github.com/Prodicode/ann-visualizer?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more</a></p>
<p>工具包<br>36、Tfjs：一个基于JS的ML模型训练部署工具包。【10268 stars on Github】<br>项目地址：<br><a href="https://github.com/tensorflow/tfjs?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more" target="_blank" rel="noopener">https://github.com/tensorflow/tfjs?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more</a></p>
<p>37：Dopamine：快速的强化学习研究框架。【7142 stars on Github】<br>项目地址：<br><a href="https://github.com/google/dopamine?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more" target="_blank" rel="noopener">https://github.com/google/dopamine?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more</a></p>
<p>38、Lime：分类器解释工具包。【5173 stars on Github】<br>项目地址：<br><a href="https://github.com/marcotcr/lime?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more" target="_blank" rel="noopener">https://github.com/marcotcr/lime?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more</a></p>
<p>39、Autokeras：自动机器学习的开源软件库。【4520 stars on Github】<br>项目地址：<br><a href="https://github.com/jhfjhfj1/autokeras?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more" target="_blank" rel="noopener">https://github.com/jhfjhfj1/autokeras?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more</a></p>
<p>40、Shap：神经网络解释工具。【3496 stars on Github】<br>项目地址：<br><a href="https://github.com/slundberg/shap?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more" target="_blank" rel="noopener">https://github.com/slundberg/shap?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more</a></p>
<p>41、MMdnn：模型适配器。【3021 stars on Github】<br>项目地址：<br><a href="https://github.com/Microsoft/MMdnn?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more" target="_blank" rel="noopener">https://github.com/Microsoft/MMdnn?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more</a></p>
<p>42、Mlflow：机器学习生命周期管理。【3013 stars on Github】<br>项目地址：<br><a href="https://github.com/mlflow/mlflow?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more" target="_blank" rel="noopener">https://github.com/mlflow/mlflow?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more</a></p>
<p>43、Mace：面向移动计算平台的深度学习推断框架。【2979 stars on Github】<br>项目地址：<br><a href="https://github.com/XiaoMi/mace?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more" target="_blank" rel="noopener">https://github.com/XiaoMi/mace?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more</a></p>
<p>44、PySyft：关注安全性的深度学习库。【2595 stars on Github】<br>项目地址：<br><a href="https://github.com/OpenMined/PySyft?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more" target="_blank" rel="noopener">https://github.com/OpenMined/PySyft?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more</a></p>
<p>45、Adanet：AutoML计算库。【2293 stars on Github】<br>项目地址：<br><a href="https://github.com/tensorflow/adanet?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more" target="_blank" rel="noopener">https://github.com/tensorflow/adanet?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more</a></p>
<p>46、Tencent-ml-images：最大的多标签图像数据库。【2094 stars on Github】<br>项目地址：<br><a href="https://github.com/Tencent/tencent-ml-images?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more" target="_blank" rel="noopener">https://github.com/Tencent/tencent-ml-images?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more</a></p>
<p>47、Donkeycar、开源的软硬件自动驾驶平台。【1207 stars on Github】</p>
<p>项目地址：<br><a href="https://github.com/autorope/donkeycar?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more" target="_blank" rel="noopener">https://github.com/autorope/donkeycar?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more</a></p>
<p>48、PocketFlow：自动模型压缩框架。【1677 stars on Github】<br>项目地址：<br><a href="https://github.com/Tencent/PocketFlow?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more" target="_blank" rel="noopener">https://github.com/Tencent/PocketFlow?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more</a></p>
<p>49、DALI：深度学习应用的优化工具包以及数据处理扩展引擎。【1013 stars on Github】<br>项目地址：<br><a href="https://github.com/NVIDIA/dali?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more" target="_blank" rel="noopener">https://github.com/NVIDIA/dali?utm_source=mybridge&amp;utm_medium=blog&amp;utm_campaign=read_more</a></p>
<p><a href="https://mp.weixin.qq.com/s?__biz=MzIyOTkyOTEzOQ==&mid=2247484033&idx=1&sn=fd58e5e58f50917809d6cf133b3f7476&chksm=e8ba7b5ddfcdf24bb77d9b6db0084733d9d2815d350a0fbfc8401191c3206b72db588e51c41c&sessionid=0&scene=126&clicktime=1568597193&enterid=1568597193&asce" target="_blank" rel="noopener">传送门</a></p>

        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-image">
        <a href="/2019/09/12/TensorFlow-2-0-RC-is-available/" class="image is-7by1">
            <img class="thumbnail" src="/images/jdenticon/0324c5ccc3a32ce2e93b3c4381465d98c7daadd18368ce5a831d1b6c7227dd20.png" alt="TensorFlow 2.0 RC is available">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-09-12T13:41:44.000Z">2019-09-12</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/文章/">文章</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    3 分钟 读完 (大约 382 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/09/12/TensorFlow-2-0-RC-is-available/">TensorFlow 2.0 RC is available</a>
            
        </h1>
        <div class="content">
            <p><img src="/images/2019/09/12/fc47ee60-d560-11e9-b847-b9c45ddd4bb9.png" alt="image.png"></p>
<h1 id="TensorFlow-2-0-RC"><a href="#TensorFlow-2-0-RC" class="headerlink" title="TensorFlow 2.0 RC"></a>TensorFlow 2.0 RC</h1><p>工具<br>探索可支持和加速 TensorFlow 工作流程的工具。</p>
<p><img src="/images/2019/09/12/0d102030-d563-11e9-b847-b9c45ddd4bb9.png" alt="image.png"></p>
<h2 id="CoLab"><a href="#CoLab" class="headerlink" title="CoLab"></a>CoLab</h2><p>Colaboratory 是一个免费的 Jupyter 笔记本环境，不需要进行任何设置就可以使用，并且完全在云端运行。借助 Colaboratory，您只需点击一下鼠标，即可在浏览器中执行 TensorFlow 代码。</p>
<h2 id="TensorBoard"><a href="#TensorBoard" class="headerlink" title="TensorBoard"></a>TensorBoard</h2><p>一套可视化工具，用于理解、调试和优化TensorFlow程序。</p>
<h2 id="What-If工具"><a href="#What-If工具" class="headerlink" title="What-If工具"></a>What-If工具</h2><p>一种无代码的方式探究机器学习模型的工具，对模型的理解、调试和公平性很有用。可在TensorFlow和Jupyter或CoLab笔记本中使用。</p>
<h2 id="ML-Perf"><a href="#ML-Perf" class="headerlink" title="ML Perf"></a>ML Perf</h2><p>全面的机器学习基准测试套件，用于衡量机器学习软件框架、机器学习硬件加速器和机器学习云端平台的性能。</p>
<h2 id="XLA"><a href="#XLA" class="headerlink" title="XLA"></a>XLA</h2><p>XLA(加速线性代数)是一种特定领域的线性代数编译器，能够优化TensorFlow计算，它可以提高服务器和移动平台的运行速度改进内存使用情况和可移植性。</p>
<h2 id="TensorFlow-Playground"><a href="#TensorFlow-Playground" class="headerlink" title="TensorFlow Playground"></a>TensorFlow Playground</h2><p>在浏览器中设计神经网络。别担心，不会使浏览器崩溃。</p>
<h2 id="TensorFlow-Research-Cloud"><a href="#TensorFlow-Research-Cloud" class="headerlink" title="TensorFlow Research Cloud"></a>TensorFlow Research Cloud</h2><p>加入TensorFlow Research Cloud（TFRC）计划后，研究人员可于申请访问Cloud TPU来加快实现下一波研究突破；我们免费提供1000个Cloud TPU.</p>

        </div>
        
        
        
    </div>
</div>








</div>
                




<div class="column is-4-tablet is-4-desktop is-3-widescreen  has-order-1 column-left is-sticky">
    
        
<div class="card widget">
    <div class="card-content">
        <nav class="level">
            <div class="level-item has-text-centered" style="flex-shrink: 1">
                <div>
                    
                    <figure class="image is-128x128 has-mb-6">
                        <img class="is-rounded" src="https://hsutimes.github.io/images/16530d7f26a413c2.png" alt="Time">
                    </figure>
                    
                    <p class="is-size-4 is-block">
                        Time
                    </p>
                    
                    
                    <p class="is-size-6 is-block">
                        Developer
                    </p>
                    
                    
                    <p class="is-size-6 is-flex is-flex-center has-text-grey">
                        <i class="fas fa-map-marker-alt has-mr-7"></i>
                        <span>Earth, Solar System</span>
                    </p>
                    
                </div>
            </div>
        </nav>
        <nav class="level is-mobile">
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        文章
                    </p>
                    <a href="/archives">
                        <p class="title has-text-weight-normal">
                            98
                        </p>
                    </a>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        分类
                    </p>
                    <a href="/categories">
                        <p class="title has-text-weight-normal">
                            6
                        </p>
                    </a>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        标签
                    </p>
                    <a href="/tags">
                        <p class="title has-text-weight-normal">
                            122
                        </p>
                    </a>
                </div>
            </div>
        </nav>
        
        <div class="level">
            <a class="level-item button is-link is-rounded" href="https://github.com/hsutimes" target="_blank">
                关注我</a>
        </div>
        
        
        
        <div class="level is-mobile">
            
            <a class="level-item button is-white is-marginless" target="_blank"
                title="Github" href="https://github.com/hsutimes">
                
                <i class="fab fa-github"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank"
                title="Facebook" href="https://facebook.com">
                
                <i class="fab fa-facebook"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank"
                title="Twitter" href="https://twitter.com/times26740863">
                
                <i class="fab fa-twitter"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank"
                title="Dribbble" href="https://dribbble.com">
                
                <i class="fab fa-dribbble"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank"
                title="RSS" href="/">
                
                <i class="fas fa-rss"></i>
                
            </a>
            
        </div>
        
    </div>
</div>
    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            链接
        </h3>
        <ul class="menu-list">
        
            <li>
                <a class="level is-mobile" href="https://github.com/hsutimes" target="_blank">
                    <span class="level-left">
                        <span class="level-item">PPOffice</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">github.com</span>
                    </span>
                </a>
            </li>
        
            <li>
                <a class="level is-mobile" href="https://hsutimes.club" target="_blank">
                    <span class="level-left">
                        <span class="level-item">Time</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">hsutimes.club</span>
                    </span>
                </a>
            </li>
        
        </ul>
        </div>
    </div>
</div>

    
        
<div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                分类
            </h3>
            <ul class="menu-list">
            <li>
        <a class="level is-marginless" href="/categories/Others/">
            <span class="level-start">
                <span class="level-item">Others</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/人工智能/">
            <span class="level-start">
                <span class="level-item">人工智能</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">6</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/文章/">
            <span class="level-start">
                <span class="level-item">文章</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">76</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/生活/">
            <span class="level-start">
                <span class="level-item">生活</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">6</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/笔试/">
            <span class="level-start">
                <span class="level-item">笔试</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/算法/">
            <span class="level-start">
                <span class="level-item">算法</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">7</span>
            </span>
        </a></li>
            </ul>
        </div>
    </div>
</div>
    
    
        <div class="column-right-shadow is-hidden-widescreen is-sticky">
        
            
        
            <div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            最新文章
        </h3>
        
        <article class="media">
            
            <a href="/2019/11/18/target-detection-yolo/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/2019/11/18/cc0d9a30-0a01-11ea-b8d5-416bf8aed005.png" alt="目标检测YOLOv3">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-11-18T12:26:24.000Z">2019-11-18</time></div>
                    <a href="/2019/11/18/target-detection-yolo/" class="title has-link-black-ter is-size-6 has-text-weight-normal">目标检测YOLOv3</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/人工智能/">人工智能</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2019/11/17/quantum-computing-wave/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://www.qtumist.com/wp-content/uploads/2019/11/102419_Quantum_008_2500.jpg" alt="哈佛大学教授问与答：解析量子计算浪潮">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-11-17T14:39:05.000Z">2019-11-17</time></div>
                    <a href="/2019/11/17/quantum-computing-wave/" class="title has-link-black-ter is-size-6 has-text-weight-normal">哈佛大学教授问与答：解析量子计算浪潮</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/文章/">文章</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2019/11/16/There are no technology-driven companies in the world/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/2019/11/16/553b0d80-082f-11ea-90c6-4101d673f67d.png" alt="世界上没有技术驱动型公司">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-11-16T05:05:50.000Z">2019-11-16</time></div>
                    <a href="/2019/11/16/There are no technology-driven companies in the world/" class="title has-link-black-ter is-size-6 has-text-weight-normal">世界上没有技术驱动型公司</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/文章/">文章</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2019/11/15/PaddlePaddle/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/2019/11/15/4f36ef60-07a5-11ea-9869-b1d580c824bf.png" alt="PaddlePaddle Models">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-11-15T12:42:23.000Z">2019-11-15</time></div>
                    <a href="/2019/11/15/PaddlePaddle/" class="title has-link-black-ter is-size-6 has-text-weight-normal">PaddlePaddle Models</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/人工智能/">人工智能</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2019/11/15/peak-labs/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/2019/11/15/d0f04a90-079d-11ea-9bed-614a3ec3e924.png" alt="Peak Labs">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-11-15T11:43:37.000Z">2019-11-15</time></div>
                    <a href="/2019/11/15/peak-labs/" class="title has-link-black-ter is-size-6 has-text-weight-normal">Peak Labs</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/人工智能/">人工智能</a>
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>
        
        </div>
    
</div>

                




<div class="column is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only has-order-3 column-right is-sticky">
    
        
    
        <div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            最新文章
        </h3>
        
        <article class="media">
            
            <a href="/2019/11/18/target-detection-yolo/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/2019/11/18/cc0d9a30-0a01-11ea-b8d5-416bf8aed005.png" alt="目标检测YOLOv3">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-11-18T12:26:24.000Z">2019-11-18</time></div>
                    <a href="/2019/11/18/target-detection-yolo/" class="title has-link-black-ter is-size-6 has-text-weight-normal">目标检测YOLOv3</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/人工智能/">人工智能</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2019/11/17/quantum-computing-wave/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://www.qtumist.com/wp-content/uploads/2019/11/102419_Quantum_008_2500.jpg" alt="哈佛大学教授问与答：解析量子计算浪潮">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-11-17T14:39:05.000Z">2019-11-17</time></div>
                    <a href="/2019/11/17/quantum-computing-wave/" class="title has-link-black-ter is-size-6 has-text-weight-normal">哈佛大学教授问与答：解析量子计算浪潮</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/文章/">文章</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2019/11/16/There are no technology-driven companies in the world/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/2019/11/16/553b0d80-082f-11ea-90c6-4101d673f67d.png" alt="世界上没有技术驱动型公司">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-11-16T05:05:50.000Z">2019-11-16</time></div>
                    <a href="/2019/11/16/There are no technology-driven companies in the world/" class="title has-link-black-ter is-size-6 has-text-weight-normal">世界上没有技术驱动型公司</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/文章/">文章</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2019/11/15/PaddlePaddle/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/2019/11/15/4f36ef60-07a5-11ea-9869-b1d580c824bf.png" alt="PaddlePaddle Models">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-11-15T12:42:23.000Z">2019-11-15</time></div>
                    <a href="/2019/11/15/PaddlePaddle/" class="title has-link-black-ter is-size-6 has-text-weight-normal">PaddlePaddle Models</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/人工智能/">人工智能</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2019/11/15/peak-labs/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/2019/11/15/d0f04a90-079d-11ea-9bed-614a3ec3e924.png" alt="Peak Labs">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-11-15T11:43:37.000Z">2019-11-15</time></div>
                    <a href="/2019/11/15/peak-labs/" class="title has-link-black-ter is-size-6 has-text-weight-normal">Peak Labs</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/人工智能/">人工智能</a>
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>
    
    
</div>

            </div>
        </div>
    </section>
    <footer class="footer">
    <div class="container">
        <div class="level">
            <div class="level-start has-text-centered-mobile">
                <a class="footer-logo is-block has-mb-6" href="/">
                
                    <img src="/images/logo.svg" alt="Time" height="28">
                
                </a>
                <p class="is-size-7">
                &copy; 2019 times&nbsp;
                Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> & <a
                        href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank">Icarus</a>
                
                <br>
                <span id="busuanzi_container_site_uv">
                共<span id="busuanzi_value_site_uv">0</span>个访客
                </span>
                
                </p>
            </div>
            <div class="level-end">
            
                <div class="field has-addons is-flex-center-mobile has-mt-5-mobile is-flex-wrap is-flex-middle">
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Creative Commons" href="https://creativecommons.org/">
                        
                        <i class="fab fa-creative-commons"></i>
                        
                    </a>
                </p>
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/">
                        
                        <i class="fab fa-creative-commons-by"></i>
                        
                    </a>
                </p>
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Download on GitHub" href="https://github.com/hsutimes/hsutimes.github.io">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                </p>
                
                </div>
            
            </div>
        </div>
    </div>
</footer>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script>
<script>moment.locale("zh-CN");</script>

<script>
var IcarusThemeSettings = {
    article: {
        highlight: {
            clipboard: true,
            fold: 'unfolded'
        }
    }
};
</script>


    <script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script>



    
    
<script src="/js/animation.js"></script>

    
    
<script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script>
<script src="/js/gallery.js" defer></script>

    
    
<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update
            my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        });
    });
</script>

    
    <script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    MathJax.Hub.Config({
        'HTML-CSS': {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
});
</script>
    
    
<a id="back-to-top" title="回到顶端" href="javascript:;">
    <i class="fas fa-chevron-up"></i>
</a>
<script src="/js/back-to-top.js" defer></script>

    
    
    
    
    
    
    
    
    
    
    


<script src="/js/main.js" defer></script>

    
    <div class="searchbox ins-search">
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="想要查找什么..." />
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: '文章',
                PAGES: '页面',
                CATEGORIES: '分类',
                TAGS: '标签',
                UNTITLED: '(无标题)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script src="/js/insight.js" defer></script>
<link rel="stylesheet" href="/css/search.css">
<link rel="stylesheet" href="/css/insight.css">
    
</body>
</html>